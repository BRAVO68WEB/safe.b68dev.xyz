{"version":3,"sources":["dashboard.js"],"names":["const","lsKeys","token","viewType","uploads","uploadsAll","selected","users","page","dom","localStorage","username","permissions","menusContainer","menus","currentView","views","type","album","pageNum","filters","all","checkboxes","lastSelected","upload","user","selectAlbumContainer","cache","albums","clipboardJS","lazyLoad","imageExts","videoExts","isTriggerLoading","fadingIn","albumTitleMaxLength","albumDescMaxLength","onError","error","console","content","document","createElement","innerHTML","toString","swal","title","icon","onAxiosError","statusText","520","521","522","523","524","525","526","527","530","response","status","description","data","preparePage","verifyToken","window","location","reloadOnError","axios","post","then","success","text","removeItem","defaults","headers","common","prepareDashboard","catch","querySelector","addEventListener","domClick","event","target","classList","contains","preventDefault","itemMenus","selector","onclick","getUploads","deleteUploadsByNames","getAlbums","changeToken","changePassword","logout","params","group","getStatistics","getUsers","loop","i","item","call","Object","assign","trigger","currentTarget","remove","push","length","moderator","getAlbumsSidebar","prepareShareX","updateTrigger","newState","add","parentNode","tagName","let","getItemID","element","parent","parseInt","dataset","id","includes","action","hasAttribute","stopPropagation","setUploadsView","clearSelection","addSelectedUploadsToAlbum","select","selectAll","addToAlbum","deleteUpload","bulkDeleteUploads","displayPreview","submitAlbum","editAlbum","deleteAlbum","getNewToken","editUser","disableUser","filtersHelp","filterUploads","viewUserUploads","focusJumpToPage","switchPage","fadeAndScroll","clearTimeout","setTimeout","scrollIntoView","behavior","block","inline","func","goto","jumpToPage","checkValidity","parsed","value","isNaN","focus","undefined","url","get","files","autoPage","Math","ceil","count","basedomain","pagination","paginate","filter","extraControls","controls","unselected","hasExpiryDateColumn","some","file","expirydate","thumb","exec","extname","toLowerCase","name","original","prettyBytes","getPrettyBytes","size","prettyDate","getPrettyDate","Date","timestamp","prettyExpiryDate","appendix","userid","albumid","table","div","className","appendChild","querySelectorAll","update","tr","ip","checked","view","isimage","isvideo","src","onload","body","onerror","video","autoplay","insertAdjacentElement","buttons","splice","indexOf","JSON","stringify","selectInBetween","lastElement","thisIndex","index","lastIndex","abs","shiftKey","suffix","substring","proceed","style","trim","replace","postBulkDeleteUploads","field","values","cb","failed","textArea","seen","names","split","map","trimmed","test","prototype","hasOwnProperty","join","objective","dangerMode","cancel","confirm","closeModal","fields","Array","isArray","addUploadsToAlbum","ids","callback","choose","added","list","getElementsByTagName","removeAttribute","homeDomain","albumUrl","download","public","requestLink","identifier","purge","albumsContainer","oldAlbums","li","a","sendNewPassword","pass","password","admin","displayGroup","groups","keys","enabled","usage","groupOptions","g","resetPassword","totalItems","itemsPerPage","currentPage","numPages","template","start","end","elementsToShow","step","stats","rows","types","_types","valKeys","j","number","toLocaleString","byte","byteUsage","used","total","round","toUpperCase","defineProperty","varArgs","arguments$1","arguments","TypeError","to","nextSource","nextKey","writable","configurable","documentElement","selectedKeys","ls","parse","ClipboardJS","on","LazyLoad"],"mappings":"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","file":"dashboard.js","sourcesContent":["/* global swal, axios, ClipboardJS, LazyLoad */\n\nconst lsKeys = {\n  token: 'token',\n  viewType: {\n    uploads: 'viewTypeUploads',\n    uploadsAll: 'viewTypeUploadsAll'\n  },\n  selected: {\n    uploads: 'selectedUploads',\n    uploadsAll: 'selectedUploadsAll',\n    users: 'selectedUsers'\n  }\n}\n\nconst page = {\n  // #page\n  dom: null,\n\n  // user token\n  token: localStorage[lsKeys.token],\n\n  // from api/tokens/verify\n  username: null,\n  permissions: null,\n\n  // sidebar menus\n  menusContainer: null,\n  menus: [],\n\n  currentView: null,\n  views: {\n    // config of uploads view\n    uploads: {\n      type: localStorage[lsKeys.viewType.uploads],\n      album: null, // album's id\n      pageNum: null // page num\n    },\n    // config of uploads view (all)\n    uploadsAll: {\n      type: localStorage[lsKeys.viewType.uploadsAll],\n      filters: null, // uploads' filters\n      pageNum: null, // page num\n      all: true\n    },\n    // config of users view\n    users: {\n      pageNum: null\n    }\n  },\n\n  // id of selected items (shared across pages and will be synced with localStorage)\n  selected: {\n    uploads: [],\n    uploadsAll: [],\n    users: []\n  },\n  checkboxes: {\n    uploads: [],\n    uploadsAll: [],\n    users: []\n  },\n  lastSelected: {\n    upload: null,\n    uploadsAll: null,\n    user: null\n  },\n\n  // select album dom for dialogs/modals\n  selectAlbumContainer: null,\n\n  // cache for dialogs/modals\n  cache: {\n    uploads: {},\n    albums: {},\n    users: {}\n  },\n\n  clipboardJS: null,\n  lazyLoad: null,\n\n  imageExts: ['.webp', '.jpg', '.jpeg', '.gif', '.png', '.tiff', '.tif', '.svg'],\n  // some of these extensions can not be played directly in browsers\n  videoExts: ['.webm', '.mp4', '.wmv', '.avi', '.mov', '.mkv'],\n\n  isTriggerLoading: null,\n  fadingIn: null,\n\n  albumTitleMaxLength: 70,\n  albumDescMaxLength: 4000\n}\n\n// Handler for regular JS errors\npage.onError = error => {\n  console.error(error)\n\n  const content = document.createElement('div')\n  content.innerHTML = `<code>${error.toString()}</code>`\n  return swal({\n    title: 'An error occurred!',\n    icon: 'error',\n    content\n  })\n}\n\n// Handler for Axios errors\npage.onAxiosError = error => {\n  console.error(error)\n\n  // Better Cloudflare errors\n  const cloudflareErrors = {\n    520: 'Unknown Error',\n    521: 'Web Server Is Down',\n    522: 'Connection Timed Out',\n    523: 'Origin Is Unreachable',\n    524: 'A Timeout Occurred',\n    525: 'SSL Handshake Failed',\n    526: 'Invalid SSL Certificate',\n    527: 'Railgun Error',\n    530: 'Origin DNS Error'\n  }\n\n  const statusText = cloudflareErrors[error.response.status] || error.response.statusText\n  const description = error.response.data && error.response.data.description\n    ? error.response.data.description\n    : 'There was an error with the request, please check the console for more information.'\n\n  return swal(`${error.response.status} ${statusText}`, description, 'error')\n}\n\npage.preparePage = () => {\n  if (page.token)\n    page.verifyToken(page.token, true)\n  else\n    window.location = 'auth'\n}\n\npage.verifyToken = (token, reloadOnError) => {\n  axios.post('api/tokens/verify', { token }).then(response => {\n    if (response.data.success === false)\n      return swal({\n        title: 'An error occurred!',\n        text: response.data.description,\n        icon: 'error'\n      }).then(() => {\n        if (!reloadOnError) return\n        localStorage.removeItem(lsKeys.token)\n        window.location = 'auth'\n      })\n\n    axios.defaults.headers.common.token = token\n    localStorage[lsKeys.token] = token\n\n    page.token = token\n    page.username = response.data.username\n    page.permissions = response.data.permissions\n    page.prepareDashboard()\n  }).catch(page.onAxiosError)\n}\n\npage.prepareDashboard = () => {\n  page.dom = document.querySelector('#page')\n\n  // Capture all click events\n  page.dom.addEventListener('click', page.domClick, true)\n\n  // Capture all submit events\n  page.dom.addEventListener('submit', event => {\n    // Prevent default if necessary\n    if (event.target && event.target.classList.contains('prevent-default'))\n      return event.preventDefault()\n  }, true)\n\n  page.menusContainer = document.querySelector('#menu')\n\n  // All item menus in the sidebar\n  const itemMenus = [\n    { selector: '#itemUploads', onclick: page.getUploads },\n    { selector: '#itemDeleteUploadsByNames', onclick: page.deleteUploadsByNames },\n    { selector: '#itemManageAlbums', onclick: page.getAlbums },\n    { selector: '#itemManageToken', onclick: page.changeToken },\n    { selector: '#itemChangePassword', onclick: page.changePassword },\n    { selector: '#itemLogout', onclick: page.logout },\n    { selector: '#itemManageUploads', onclick: page.getUploads, params: { all: true }, group: 'moderator' },\n    { selector: '#itemStatistics', onclick: page.getStatistics, group: 'admin' },\n    { selector: '#itemManageUsers', onclick: page.getUsers, group: 'admin' }\n  ]\n\n  for (let i = 0; i < itemMenus.length; i++) {\n    // Skip item menu if not enough permission\n    if (itemMenus[i].group && !page.permissions[itemMenus[i].group])\n      continue\n\n    // Add onclick event listener\n    const item = document.querySelector(itemMenus[i].selector)\n    item.addEventListener('click', event => {\n      // This class name isn't actually being applied fast enough\n      if (page.menusContainer.classList.contains('is-loading'))\n        return\n\n      // eslint-disable-next-line compat/compat\n      itemMenus[i].onclick.call(null, Object.assign({\n        trigger: event.currentTarget\n      }, itemMenus[i].params || {}))\n    })\n\n    item.classList.remove('is-hidden')\n    page.menus.push(item)\n  }\n\n  // If at least a moderator, show administration section\n  if (page.permissions.moderator) {\n    document.querySelector('#itemLabelAdmin').classList.remove('is-hidden')\n    document.querySelector('#itemListAdmin').classList.remove('is-hidden')\n  }\n\n  // Update text of logout button\n  document.querySelector('#itemLogout').innerHTML = `Logout ( ${page.username} )`\n\n  // Finally display dashboard\n  document.querySelector('#dashboard').classList.remove('is-hidden')\n\n  // Load albums sidebar\n  page.getAlbumsSidebar()\n\n  if (typeof page.prepareShareX === 'function')\n    page.prepareShareX()\n}\n\npage.logout = params => {\n  page.updateTrigger(params.trigger, 'active')\n  localStorage.removeItem(lsKeys.token)\n  window.location = 'auth'\n}\n\npage.updateTrigger = (trigger, newState) => {\n  if (!trigger) return\n\n  // Disable menus container when loading\n  if (newState === 'loading')\n    page.menusContainer.classList.add('is-loading')\n  else\n    page.menusContainer.classList.remove('is-loading')\n\n  if (newState === 'loading') {\n    trigger.classList.add('is-loading')\n  } else if (newState === 'active') {\n    if (trigger.parentNode.tagName !== 'LI')\n      return\n    for (let i = 0; i < page.menus.length; i++)\n      page.menus[i].classList.remove('is-active')\n    trigger.classList.remove('is-loading')\n    trigger.classList.add('is-active')\n  } else {\n    trigger.classList.remove('is-loading')\n    trigger.classList.remove('is-active')\n  }\n}\n\npage.getItemID = element => {\n  // This expects the item's parent to have the item's ID\n  let parent = element.parentNode\n  // If the element is part of a set of controls, use the container's parent instead\n  if (element.parentNode.classList.contains('controls')) parent = parent.parentNode\n  return parseInt(parent.dataset.id)\n}\n\npage.domClick = event => {\n  // We are processing clicks this way to avoid using \"onclick\" attribute\n  // Apparently we will need to use \"unsafe-inline\" for \"script-src\" directive\n  // of Content Security Policy (CSP), if we want to use \"onclick\" attribute\n  // Though I think that only applies to some browsers (?)\n  // Of course it wouldn't have mattered if we didn't use CSP to begin with\n  // Anyway, I personally would rather not use \"onclick\" attribute\n  let element = event.target\n  if (!element) return\n\n  // Delegate click events to their A or BUTTON parents\n  if (['I'].includes(element.tagName) && ['SPAN'].includes(element.parentNode.tagName))\n    element = element.parentNode\n  if (['SPAN'].includes(element.tagName) && ['A', 'BUTTON'].includes(element.parentNode.tagName))\n    element = element.parentNode\n\n  // Skip elements that have no action data\n  if (!element.dataset || !element.dataset.action) return\n\n  // Skip disabled elements\n  if (element.hasAttribute('disabled')) return\n\n  event.stopPropagation() // maybe necessary\n  const id = page.getItemID(element)\n  const action = element.dataset.action\n\n  switch (action) {\n    case 'view-list':\n      return page.setUploadsView('list', element)\n    case 'view-thumbs':\n      return page.setUploadsView('thumbs', element)\n    case 'clear-selection':\n      return page.clearSelection()\n    case 'add-selected-uploads-to-album':\n      return page.addSelectedUploadsToAlbum()\n    case 'select':\n      return page.select(element, event)\n    case 'select-all':\n      return page.selectAll(element)\n    case 'add-to-album':\n      return page.addToAlbum(id)\n    case 'delete-upload':\n      return page.deleteUpload(id)\n    case 'bulk-delete-uploads':\n      return page.bulkDeleteUploads()\n    case 'display-preview':\n      return page.displayPreview(id)\n    case 'submit-album':\n      return page.submitAlbum(element)\n    case 'edit-album':\n      return page.editAlbum(id)\n    case 'delete-album':\n      return page.deleteAlbum(id)\n    case 'get-new-token':\n      return page.getNewToken(element)\n    case 'edit-user':\n      return page.editUser(id)\n    case 'disable-user':\n      return page.disableUser(id)\n    case 'filters-help':\n      return page.filtersHelp(element)\n    case 'filter-uploads':\n      return page.filterUploads(element)\n    case 'view-user-uploads':\n      return page.viewUserUploads(id, element)\n    case 'page-ellipsis':\n      return page.focusJumpToPage()\n    case 'page-prev':\n    case 'page-next':\n    case 'page-goto':\n    case 'jump-to-page':\n      return page.switchPage(action, element)\n  }\n}\n\npage.fadeAndScroll = content => {\n  if (page.fadingIn) {\n    clearTimeout(page.fadingIn)\n    page.dom.classList.remove('fade-in')\n  }\n\n  page.dom.classList.add('fade-in')\n  page.fadingIn = setTimeout(() => {\n    page.dom.classList.remove('fade-in')\n  }, 500)\n\n  page.dom.scrollIntoView({\n    behavior: 'smooth',\n    block: 'start',\n    inline: 'nearest'\n  })\n}\n\npage.switchPage = (action, element) => {\n  // eslint-disable-next-line compat/compat\n  const params = Object.assign({\n    trigger: element\n  }, page.views[page.currentView])\n  const func = page.currentView === 'users' ? page.getUsers : page.getUploads\n  switch (action) {\n    case 'page-prev':\n      params.pageNum = page.views[page.currentView].pageNum - 1\n      if (params.pageNum < 0)\n        return swal('An error occurred!', 'This is already the first page.', 'error')\n      return func(params)\n    case 'page-next':\n      params.pageNum = page.views[page.currentView].pageNum + 1\n      return func(params)\n    case 'page-goto':\n      params.pageNum = parseInt(element.dataset.goto)\n      return func(params)\n    case 'jump-to-page': {\n      const jumpToPage = document.querySelector('#jumpToPage')\n      if (!jumpToPage.checkValidity()) return\n      const parsed = parseInt(jumpToPage.value)\n      params.pageNum = isNaN(parsed) ? 0 : (parsed - 1)\n      if (params.pageNum < 0) params.pageNum = 0\n      return func(params)\n    }\n  }\n}\n\npage.focusJumpToPage = () => {\n  const element = document.querySelector('#jumpToPage')\n  if (!element) return\n  element.focus()\n  element.select()\n}\n\npage.getUploads = (params = {}) => {\n  if (params === undefined)\n    params = {}\n\n  if ((params.all || params.filters) && !page.permissions.moderator)\n    return swal('An error occurred!', 'You can not do this!', 'error')\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (typeof params.pageNum !== 'number' || params.pageNum < 0)\n    params.pageNum = 0\n\n  const url = params.album !== undefined\n    ? `api/album/${params.album}/${params.pageNum}`\n    : `api/uploads/${params.pageNum}`\n\n  const headers = {\n    all: params.all ? '1' : '',\n    filters: params.filters || ''\n  }\n\n  axios.get(url, { headers }).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const files = response.data.files\n    if (params.pageNum && (files.length === 0))\n      if (params.autoPage) {\n        params.pageNum = Math.ceil(response.data.count / 25) - 1\n        return page.getUploads(params)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', `There are no more uploads to populate page ${params.pageNum + 1}.`, 'error')\n      }\n\n    page.currentView = params.all ? 'uploadsAll' : 'uploads'\n    page.cache.uploads = {}\n\n    const albums = response.data.albums\n    const users = response.data.users\n    const basedomain = response.data.basedomain\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    let filter = '<div class=\"column is-hidden-mobile\"></div>'\n    if (params.all)\n      filter = `\n        <div class=\"column\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filters\" value=\"${params.filters || ''}\">\n              </div>\n              <div class=\"control\">\n                <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help?\" data-action=\"filters-help\">\n                  <span class=\"icon\">\n                    <i class=\"icon-help-circled\"></i>\n                  </span>\n                </button>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter uploads\" data-action=\"filter-uploads\">\n                  <span class=\"icon\">\n                    <i class=\"icon-filter\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" value=\"${params.pageNum + 1}\">\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column is-hidden-mobile\"></div>\n        <div class=\"column has-text-centered\">\n          <a class=\"button is-small is-danger is-outlined\" title=\"List view\" data-action=\"view-list\">\n            <span class=\"icon\">\n              <i class=\"icon-th-list\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Thumbs view\" data-action=\"view-thumbs\">\n            <span class=\"icon\">\n              <i class=\"icon-th-large\"></i>\n            </span>\n          </a>\n        </div>\n        <div class=\"column has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          ${params.all ? '' : `\n          <a class=\"button is-small is-warning is-outlined\" title=\"Bulk add to album\" data-action=\"add-selected-uploads-to-album\">\n            <span class=\"icon\">\n              <i class=\"icon-plus\"></i>\n            </span>\n          </a>`}\n          <a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete\" data-action=\"bulk-delete-uploads\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    const hasExpiryDateColumn = files.some(file => {\n      return file.expirydate !== undefined\n    })\n\n    for (let i = 0; i < files.length; i++) {\n      // Build full URLs\n      files[i].file = `${basedomain}/${files[i].name}`\n      if (files[i].thumb)\n        files[i].thumb = `${basedomain}/${files[i].thumb}`\n\n      // Determine types\n      files[i].type = 'other'\n      const exec = /.[\\w]+(\\?|$)/.exec(files[i].file)\n      const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n      if (page.imageExts.includes(extname))\n        files[i].type = 'picture'\n      else if (page.videoExts.includes(extname))\n        files[i].type = 'video'\n\n      // Cache bare minimum data for thumbnails viewer\n      page.cache.uploads[files[i].id] = {\n        name: files[i].name,\n        thumb: files[i].thumb,\n        original: files[i].file,\n        type: files[i].type\n      }\n\n      // Prettify\n      files[i].prettyBytes = page.getPrettyBytes(parseInt(files[i].size))\n      files[i].prettyDate = page.getPrettyDate(new Date(files[i].timestamp * 1000))\n\n      if (hasExpiryDateColumn)\n        files[i].prettyExpiryDate = files[i].expirydate\n          ? page.getPrettyDate(new Date(files[i].expirydate * 1000))\n          : null\n\n      // Update selected status\n      files[i].selected = page.selected[page.currentView].includes(files[i].id)\n      if (!files[i].selected) unselected = true\n\n      // Appendix (display album or user)\n      if (params.all)\n        files[i].appendix = files[i].userid\n          ? users[files[i].userid] || ''\n          : ''\n      else if (params.album === undefined)\n        files[i].appendix = files[i].albumid\n          ? albums[files[i].albumid] || ''\n          : ''\n    }\n\n    if (page.views[page.currentView].type === 'thumbs') {\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div id=\"table\" class=\"columns is-multiline is-mobile is-centered\">\n        </div>\n        ${pagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const div = document.createElement('div')\n        div.className = 'image-container column'\n        div.dataset.id = upload.id\n\n        if (upload.thumb !== undefined)\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\" rel=\"noopener\"><img alt=\"${upload.name}\" data-src=\"${upload.thumb}\"/></a>`\n        else\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\" rel=\"noopener\"><h1 class=\"title\">${upload.extname || 'N/A'}</h1></a>`\n\n        div.innerHTML += `\n          <input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}>\n          <div class=\"controls\">\n            ${upload.thumb ? `\n            <a class=\"button is-small is-primary\" title=\"Display preview\" data-action=\"display-preview\">\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>` : ''}\n            <a class=\"button is-small is-info clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-warning\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-danger\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </div>\n          <div class=\"details\">\n            <p><span class=\"name\">${upload.name}</span></p>\n            <p>${upload.appendix ? `<span>${upload.appendix}</span> – ` : ''}${upload.prettyBytes}</p>\n            ${hasExpiryDateColumn && upload.prettyExpiryDate ? `\n            <p class=\"expirydate\">EXP: ${upload.prettyExpiryDate}</p>` : ''}\n          </div>\n        `\n\n        table.appendChild(div)\n        page.checkboxes[page.currentView] = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n        page.lazyLoad.update()\n      }\n    } else {\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div class=\"table-container\">\n          <table class=\"table is-narrow is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n                <th>File</th>\n                ${params.album === undefined ? `<th>${params.all ? 'User' : 'Album'}</th>` : ''}\n                <th>Size</th>\n                ${params.all ? '<th>IP</th>' : ''}\n                <th>Date</th>\n                ${hasExpiryDateColumn ? '<th>Expiry date</th>' : ''}\n                <th></th>\n              </tr>\n            </thead>\n            <tbody id=\"table\">\n            </tbody>\n          </table>\n        </div>\n        ${pagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const tr = document.createElement('tr')\n        tr.dataset.id = upload.id\n        tr.innerHTML = `\n          <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}></td>\n          <th><a href=\"${upload.file}\" target=\"_blank\" rel=\"noopener\" title=\"${upload.file}\">${upload.name}</a></th>\n          ${params.album === undefined ? `<th>${upload.appendix}</th>` : ''}\n          <td>${upload.prettyBytes}</td>\n          ${params.all ? `<td>${upload.ip || ''}</td>` : ''}\n          <td>${upload.prettyDate}</td>\n          ${hasExpiryDateColumn ? `<td>${upload.prettyExpiryDate || '-'}</td>` : ''}\n          <td class=\"controls has-text-right\">\n            <a class=\"button is-small is-primary is-outlined\" title=\"${upload.thumb ? 'Display preview' : 'File can\\'t be previewed'}\" data-action=\"display-preview\"${upload.thumb ? '' : ' disabled'}>\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            ${params.all ? '' : `\n            <a class=\"button is-small is-warning is-outlined\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>`}\n            <a class=\"button is-small is-danger is-outlined\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </td>\n        `\n\n        table.appendChild(tr)\n        page.checkboxes[page.currentView] = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n      }\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n\n    if (page.currentView === 'uploads')\n      page.views.uploads.album = params.album\n    if (page.currentView === 'uploadsAll')\n      page.views.uploadsAll.filters = params.filters\n    page.views[page.currentView].pageNum = files.length ? params.pageNum : 0\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.setUploadsView = (view, element) => {\n  localStorage[lsKeys.viewType[page.currentView]] = view\n  page.views[page.currentView].type = view\n  // eslint-disable-next-line compat/compat\n  page.getUploads(Object.assign({\n    trigger: element\n  }, page.views[page.currentView]))\n}\n\npage.displayPreview = id => {\n  const file = page.cache.uploads[id]\n  if (!file.thumb) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field has-text-centered\">\n      <label class=\"label\">${file.name}</label>\n      <div class=\"controls swal-display-thumb-container\">\n        <img id=\"swalThumb\" src=\"${file.thumb}\">\n      </div>\n    </div>\n  `\n\n  if (file.original) {\n    const exec = /.[\\w]+(\\?|$)/.exec(file.original)\n    const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n    const isimage = page.imageExts.includes(extname)\n    const isvideo = !isimage && page.videoExts.includes(extname)\n\n    if (isimage || isvideo) {\n      div.innerHTML += `\n        <div class=\"field has-text-centered\">\n          <div class=\"controls\">\n            <a id=\"swalOriginal\" type=\"button\" class=\"button is-info is-outlined is-fullwidth\" data-original=\"${file.original}\">\n              <span class=\"icon\">\n                <i class=\"icon-arrows-cw\"></i>\n              </span>\n              <span>Load original</span>\n            </a>\n          </div>\n        </div>\n      `\n\n      div.querySelector('#swalOriginal').addEventListener('click', event => {\n        const trigger = event.currentTarget\n        if (trigger.classList.contains('is-danger'))\n          return\n\n        trigger.classList.add('is-loading')\n        const thumb = div.querySelector('#swalThumb')\n\n        if (isimage) {\n          thumb.src = file.original\n          thumb.onload = () => {\n            trigger.classList.add('is-hidden')\n            document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n          }\n          thumb.onerror = event => {\n            event.currentTarget.classList.add('is-hidden')\n            trigger.className = 'button is-danger is-fullwidth'\n            trigger.innerHTML = `\n              <span class=\"icon\">\n                <i class=\"icon-block\"></i>\n              </span>\n              <span>Unable to load original</span>\n            `\n          }\n        } else if (isvideo) {\n          thumb.classList.add('is-hidden')\n          const video = document.createElement('video')\n          video.id = 'swalVideo'\n          video.controls = true\n          video.autoplay = true\n          video.src = file.original\n          thumb.insertAdjacentElement('afterend', video)\n\n          trigger.classList.add('is-hidden')\n          document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n        }\n      })\n    }\n  }\n\n  return swal({\n    content: div,\n    buttons: false\n  }).then(() => {\n    // Destroy video, if necessary\n    const video = div.querySelector('#swalVideo')\n    if (video) video.remove()\n\n    // Restore modal size\n    document.body.querySelector('.swal-overlay .swal-modal').classList.remove('is-expanded')\n  })\n}\n\npage.selectAll = element => {\n  for (let i = 0; i < page.checkboxes[page.currentView].length; i++) {\n    const id = page.getItemID(page.checkboxes[page.currentView][i])\n    if (isNaN(id)) continue\n    if (page.checkboxes[page.currentView][i].checked !== element.checked) {\n      page.checkboxes[page.currentView][i].checked = element.checked\n      if (page.checkboxes[page.currentView][i].checked)\n        page.selected[page.currentView].push(id)\n      else\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n    }\n  }\n\n  if (page.selected[page.currentView].length)\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  else\n    delete localStorage[lsKeys.selected[page.currentView]]\n\n  element.title = element.checked ? 'Unselect all' : 'Select all'\n}\n\npage.selectInBetween = (element, lastElement) => {\n  const thisIndex = parseInt(element.dataset.index)\n  const lastIndex = parseInt(lastElement.dataset.index)\n\n  const distance = Math.abs(thisIndex - lastIndex)\n  if (distance < 2)\n    return\n\n  for (let i = 0; i < page.checkboxes[page.currentView].length; i++)\n    if ((thisIndex > lastIndex && i > lastIndex && i < thisIndex) ||\n      (thisIndex < lastIndex && i > thisIndex && i < lastIndex)) {\n      // Check or uncheck depending on the state of the initial checkbox\n      const checked = page.checkboxes[page.currentView][i].checked = lastElement.checked\n      const id = page.getItemID(page.checkboxes[page.currentView][i])\n      if (!page.selected[page.currentView].includes(id) && checked)\n        page.selected[page.currentView].push(id)\n      else if (page.selected[page.currentView].includes(id) && !checked)\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n    }\n}\n\npage.select = (element, event) => {\n  const id = page.getItemID(element)\n  if (isNaN(id)) return\n\n  const lastSelected = page.lastSelected[page.currentView]\n  if (event.shiftKey && lastSelected) {\n    page.selectInBetween(element, lastSelected)\n    // Check or uncheck depending on the state of the initial checkbox\n    element.checked = lastSelected.checked\n  } else {\n    page.lastSelected[page.currentView] = element\n  }\n\n  if (!page.selected[page.currentView].includes(id) && element.checked)\n    page.selected[page.currentView].push(id)\n  else if (page.selected[page.currentView].includes(id) && !element.checked)\n    page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n\n  // Update local storage\n  if (page.selected[page.currentView].length)\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  else\n    delete localStorage[lsKeys.selected[page.currentView]]\n}\n\npage.clearSelection = () => {\n  const selected = page.selected[page.currentView]\n  const type = page.currentView === 'users' ? 'users' : 'uploads'\n  const count = selected.length\n  if (!count)\n    return swal('An error occurred!', `You have not selected any ${type}.`, 'error')\n\n  const suffix = count === 1 ? type.substring(0, type.length - 1) : type\n  return swal({\n    title: 'Are you sure?',\n    text: `You are going to unselect ${count} ${suffix}.`,\n    buttons: true\n  }).then(proceed => {\n    if (!proceed) return\n\n    const checkboxes = page.checkboxes[page.currentView]\n    for (let i = 0; i < checkboxes.length; i++)\n      if (checkboxes[i].checked)\n        checkboxes[i].checked = false\n\n    page.selected[page.currentView] = []\n    delete localStorage[lsKeys.selected[page.currentView]]\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll) selectAll.checked = false\n\n    return swal('Cleared selection!', `Unselected ${count} ${suffix}.`, 'success')\n  })\n}\n\npage.filtersHelp = element => {\n  const content = document.createElement('div')\n  content.style = 'text-align: left'\n  content.innerHTML = `\n    This supports 3 filter keys, namely <b>user</b> (username), <b>ip</b> and <b>name</b> (upload name).\n    Each key can be specified more than once.\n    Backlashes should be used if the usernames have spaces.\n    There are also 2 additional flags, namely <b>-user</b> and <b>-ip</b>, which will match uploads by non-registered users and have no IPs respectively.\n\n    How does it work?\n    First, it will filter uploads matching ANY of the supplied <b>user</b> or <b>ip</b> keys.\n    Then, it will refine the matches using the supplied <b>name</b> keys.\n\n    Examples:\n\n    Uploads from user with username \"demo\":\n    <code>user:demo</code>\n\n    Uploads from users with username either \"John Doe\" OR \"demo\":\n    <code>user:John\\\\ Doe user:demo</code>\n\n    Uploads from IP \"127.0.0.1\" AND which upload names match \"*.rar\" OR \"*.zip\":\n    <code>ip:127.0.0.1 name:*.rar name:*.zip</code>\n\n    Uploads from user with username \"test\" OR from non-registered users:\n    <code>user:test -user</code>\n  `.trim().replace(/^ {6}/gm, '').replace(/\\n/g, '<br>')\n  swal({ content })\n}\n\npage.filterUploads = element => {\n  const filters = document.querySelector('#filters').value\n  page.getUploads({ all: true, filters }, element)\n}\n\npage.viewUserUploads = (id, element) => {\n  const user = page.cache.users[id]\n  if (!user) return\n  element.classList.add('is-loading')\n  page.getUploads({\n    all: true,\n    filters: `user:${user.username.replace(/ /g, '\\\\ ')}`,\n    trigger: document.querySelector('#itemManageUploads')\n  })\n}\n\npage.deleteUpload = id => {\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: [id],\n    cb (failed) {\n      // Remove from remembered checkboxes if necessary\n      if (!failed.length && page.selected[page.currentView].includes(id))\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n\n      // Update local storage\n      if (page.selected[page.currentView].length)\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      else\n        delete localStorage[lsKeys.selected[page.currentView]]\n\n      // Reload upload list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign({\n        autoPage: true\n      }, page.views[page.currentView]))\n    }\n  })\n}\n\npage.bulkDeleteUploads = () => {\n  const count = page.selected[page.currentView].length\n  if (!count)\n    return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: page.selected[page.currentView],\n    cb (failed) {\n      // Update state of checkboxes\n      if (failed.length)\n        page.selected[page.currentView] = page.selected[page.currentView]\n          .filter(id => {\n            return failed.includes(id)\n          })\n      else\n        page.selected[page.currentView] = []\n\n      // Update local storage\n      if (page.selected[page.currentView].length)\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      else\n        delete localStorage[lsKeys.selected[page.currentView]]\n\n      // Reload uploads list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign({\n        autoPage: true\n      }, page.views[page.currentView]))\n    }\n  })\n}\n\npage.deleteUploadsByNames = (params = {}) => {\n  let appendix = ''\n  if (page.permissions.moderator)\n    appendix = '<br><b>Hint:</b> You can use this feature to delete uploads by other users.'\n\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">Upload names:</label>\n        <div class=\"control\">\n          <textarea id=\"bulkDeleteNames\" class=\"textarea\"></textarea>\n        </div>\n        <p class=\"help\">Separate each entry with a new line.${appendix}</p>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"submitBulkDelete\" class=\"button is-danger is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#submitBulkDelete').addEventListener('click', () => {\n    const textArea = document.querySelector('#bulkDeleteNames')\n\n    // Clean up\n    const seen = {}\n    const names = textArea.value\n      .split(/\\r?\\n/)\n      .map(name => {\n        const trimmed = name.trim()\n        return /^[^\\s]+$/.test(trimmed)\n          ? trimmed\n          : ''\n      })\n      .filter(name => {\n        // Filter out invalid and duplicate names\n        return (!name || Object.prototype.hasOwnProperty.call(seen, name))\n          ? false\n          : (seen[name] = true)\n      })\n\n    // Update textarea with cleaned names\n    textArea.value = names.join('\\n')\n\n    if (!names.length)\n      return swal('An error occurred!', 'You have not entered any upload names.', 'error')\n\n    page.postBulkDeleteUploads({\n      all: true,\n      field: 'name',\n      values: names,\n      cb (failed) {\n        textArea.value = failed.join('\\n')\n      }\n    })\n  })\n}\n\npage.postBulkDeleteUploads = (params = {}) => {\n  const count = params.values.length\n\n  const objective = `${params.values.length} upload${count === 1 ? '' : 's'}`\n  const boldObjective = objective.replace(/^(\\d*)(.*)/, '<b>$1</b>$2')\n  let text = `<p>You won't be able to recover ${boldObjective}!</p>`\n\n  if (params.all) {\n    const obj1 = count === 1 ? 'an upload' : 'some uploads'\n    const obj2 = count === 1 ? 'another user' : 'other users'\n    text += `\\n<p><b>Warning:</b> You may be nuking ${obj1} by ${obj2}!</p>`\n  }\n\n  const content = document.createElement('div')\n  content.innerHTML = text\n\n  swal({\n    title: 'Are you sure?',\n    content,\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: `Yes, nuke ${params.values.length === 1 ? 'it' : 'them'}!`,\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/upload/bulkdelete', {\n      field: params.fields,\n      values: params.values\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      const failed = Array.isArray(response.data.failed) ? response.data.failed : []\n      if (failed.length === params.values.length)\n        swal('An error occurred!', `Unable to delete any of the ${objective}.`, 'error')\n      else if (failed.length && failed.length < params.values.length)\n        swal('Warning!', `From ${objective}, unable to delete ${failed.length} of them.`, 'warning')\n      else\n        swal('Deleted!', `${objective} ${count === 1 ? 'has' : 'have'} been deleted.`, 'success')\n\n      if (typeof params.cb === 'function')\n        params.cb(failed)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.addSelectedUploadsToAlbum = () => {\n  if (page.currentView !== 'uploads')\n    return\n\n  const count = page.selected[page.currentView].length\n  if (!count)\n    return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.addUploadsToAlbum(page.selected[page.currentView], failed => {\n    if (!failed) return\n    if (failed.length)\n      page.selected[page.currentView] = page.selected[page.currentView].filter(id => {\n        return failed.includes(id)\n      })\n    else\n      page.selected[page.currentView] = []\n\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addToAlbum = id => {\n  page.addUploadsToAlbum([id], failed => {\n    if (!failed) return\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addUploadsToAlbum = (ids, callback) => {\n  const count = ids.length\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <div class=\"field has-text-centered\">\n      <p>You are about to add <b>${count}</b> upload${count === 1 ? '' : 's'} to an album.</p>\n      <p><b>If an upload is already in an album, it will be moved.</b></p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalAlbum\" disabled>\n            <option value=\"-1\">Remove from album</option>\n            <option value=\"\" selected disabled>Fetching albums list\\u2026</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  `\n\n  swal({\n    icon: 'warning',\n    content,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'OK',\n        closeModal: false\n      }\n    }\n  }).then(choose => {\n    if (!choose) return\n\n    const albumid = parseInt(document.querySelector('#swalAlbum').value)\n    if (isNaN(albumid))\n      return swal('An error occurred!', 'You did not choose an album.', 'error')\n\n    axios.post('api/albums/addfiles', {\n      ids,\n      albumid\n    }).then(add => {\n      if (!add) return\n\n      if (add.data.success === false) {\n        if (add.data.description === 'No token provided')\n          page.verifyToken(page.token)\n        else\n          swal('An error occurred!', add.data.description, 'error')\n\n        return\n      }\n\n      let added = ids.length\n      if (add.data.failed && add.data.failed.length)\n        added -= add.data.failed.length\n\n      const suffix = `upload${ids.length === 1 ? '' : 's'}`\n      if (!added)\n        return swal('An error occurred!', `Could not add the ${suffix} to the album.`, 'error')\n\n      swal('Woohoo!', `Successfully ${albumid < 0 ? 'removed' : 'added'} ${added} ${suffix} ${albumid < 0 ? 'from' : 'to'} the album.`, 'success')\n      callback(add.data.failed)\n    }).catch(page.onAxiosError)\n  })\n\n  // Get albums list then update content of swal\n  axios.get('api/albums').then(list => {\n    if (list.data.success === false) {\n      if (list.data.description === 'No token provided')\n        page.verifyToken(page.token)\n      else\n        swal('An error occurred!', list.data.description, 'error')\n\n      return\n    }\n\n    // If the prompt was replaced, the container would be missing\n    const select = document.querySelector('#swalAlbum')\n    if (!select) return\n\n    select.innerHTML += list.data.albums\n      .map(album => {\n        return `<option value=\"${album.id}\">${album.name}</option>`\n      })\n      .join('\\n')\n\n    select.getElementsByTagName('option')[1].innerHTML = 'Choose an album'\n    select.removeAttribute('disabled')\n  }).catch(page.onAxiosError)\n}\n\npage.getAlbums = (params = {}) => {\n  page.updateTrigger(params.trigger, 'loading')\n\n  axios.get('api/albums').then(response => {\n    if (!response) return\n\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    page.cache.albums = {}\n\n    page.dom.innerHTML = `\n      <h2 class=\"subtitle\">Create new album</h2>\n      <form class=\"prevent-default\">\n        <div class=\"field\">\n          <div class=\"control\">\n            <input id=\"albumName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\">\n          </div>\n          <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <textarea id=\"albumDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"1\" maxlength=\"${page.albumDescMaxLength}\"></textarea>\n          </div>\n          <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <button type=\"submit\" id=\"submitAlbum\" class=\"button is-info is-outlined is-fullwidth\" data-action=\"submit-album\">\n              <span class=\"icon\">\n                <i class=\"icon-paper-plane\"></i>\n              </span>\n              <span>Create</span>\n            </button>\n          </div>\n        </div>\n      </form>\n      <hr>\n      <h2 class=\"subtitle\">List of albums</h2>\n      <div class=\"table-container\">\n        <table class=\"table is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th>ID</th>\n              <th>Name</th>\n              <th>Files</th>\n              <th>Created at</th>\n              <th>Public link</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n    `\n\n    const homeDomain = response.data.homeDomain\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < response.data.albums.length; i++) {\n      const album = response.data.albums[i]\n      const albumUrl = `${homeDomain}/a/${album.identifier}`\n\n      // Prettify\n      album.prettyDate = page.getPrettyDate(new Date(album.timestamp * 1000))\n\n      page.cache.albums[album.id] = {\n        name: album.name,\n        download: album.download,\n        public: album.public,\n        description: album.description\n      }\n\n      const tr = document.createElement('tr')\n      tr.innerHTML = `\n        <th>${album.id}</th>\n        <th>${album.name}</th>\n        <th>${album.files}</th>\n        <td>${album.prettyDate}</td>\n        <td><a ${album.public ? `href=\"${albumUrl}\"` : 'class=\"is-linethrough\"'} target=\"_blank\" rel=\"noopener\">${albumUrl}</a></td>\n        <td class=\"has-text-right\" data-id=\"${album.id}\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit album\" data-action=\"edit-album\">\n            <span class=\"icon is-small\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" ${album.public ? `data-clipboard-text=\"${albumUrl}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-clipboard\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"Download album\" ${album.download ? `href=\"api/album/zip/${album.identifier}?v=${album.editedAt}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-download\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Delete album\" data-action=\"delete-album\">\n            <span class=\"icon is-small\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n    }\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.editAlbum = id => {\n  const album = page.cache.albums[id]\n  if (!album) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <div class=\"controls\">\n        <input id=\"swalName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\" value=\"${(album.name || '').substring(0, page.albumTitleMaxLength)}\">\n      </div>\n      <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <textarea id=\"swalDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"2\" maxlength=\"${page.albumDescMaxLength}\">${(album.description || '').substring(0, page.albumDescMaxLength)}</textarea>\n      </div>\n      <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalDownload\" type=\"checkbox\" ${album.download ? 'checked' : ''}>\n          Enable download\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalPublic\" type=\"checkbox\" ${album.public ? 'checked' : ''}>\n          Enable public link\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalRequestLink\" type=\"checkbox\">\n          Request new public link\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Edit album',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(value => {\n    if (!value) return\n\n    axios.post('api/albums/edit', {\n      id,\n      name: document.querySelector('#swalName').value.trim(),\n      description: document.querySelector('#swalDescription').value.trim(),\n      download: document.querySelector('#swalDownload').checked,\n      public: document.querySelector('#swalPublic').checked,\n      requestLink: document.querySelector('#swalRequestLink').checked\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      if (response.data.identifier)\n        swal('Success!', `Your album's new identifier is: ${response.data.identifier}.`, 'success')\n      else if (response.data.name !== album.name)\n        swal('Success!', `Your album was renamed to: ${response.data.name}.`, 'success')\n      else\n        swal('Success!', 'Your album was edited!', 'success')\n\n      page.getAlbumsSidebar()\n      page.getAlbums()\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.deleteAlbum = id => {\n  swal({\n    title: 'Are you sure?',\n    text: 'This won\\'t delete your uploads, only the album!',\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, delete it!',\n        closeModal: false\n      },\n      purge: {\n        text: 'Umm, delete the uploads too please?',\n        value: 'purge',\n        className: 'swal-button--danger',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/albums/delete', {\n      id,\n      purge: proceed === 'purge'\n    }).then(response => {\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else if (Array.isArray(response.data.failed) && response.data.failed.length) {\n          return swal('An error occurred!', 'Unable to delete ', 'error')\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      swal('Deleted!', 'Your album has been deleted.', 'success')\n      page.getAlbumsSidebar()\n      page.getAlbums()\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.submitAlbum = element => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/albums', {\n    name: document.querySelector('#albumName').value.trim(),\n    description: document.querySelector('#albumDescription').value.trim()\n  }).then(response => {\n    if (!response) return\n\n    page.updateTrigger(element)\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    swal('Woohoo!', 'Album was created successfully.', 'success')\n    page.getAlbumsSidebar()\n    page.getAlbums()\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getAlbumsSidebar = () => {\n  axios.get('api/albums/sidebar').then(response => {\n    if (!response) return\n\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const albumsContainer = document.querySelector('#albumsContainer')\n\n    // Clear albums sidebar if necessary\n    const oldAlbums = albumsContainer.querySelectorAll('li > a')\n    if (oldAlbums.length) {\n      for (let i = 0; i < oldAlbums.length; i++)\n        page.menus.splice(page.menus.indexOf(oldAlbums[i]), 1)\n      albumsContainer.innerHTML = ''\n    }\n\n    if (response.data.albums === undefined)\n      return\n\n    for (let i = 0; i < response.data.albums.length; i++) {\n      const album = response.data.albums[i]\n      const li = document.createElement('li')\n      const a = document.createElement('a')\n      a.id = album.id\n      a.innerHTML = album.name\n      a.className = 'is-relative'\n\n      a.addEventListener('click', event => {\n        page.getUploads({\n          album: parseInt(event.currentTarget.id),\n          trigger: event.currentTarget\n        })\n      })\n      page.menus.push(a)\n\n      li.appendChild(a)\n      albumsContainer.appendChild(li)\n    }\n  }).catch(page.onAxiosError)\n}\n\npage.changeToken = (params = {}) => {\n  page.dom.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Your current token:</label>\n      <div class=\"field\">\n        <div class=\"control\">\n          <input id=\"token\" readonly class=\"input\" type=\"text\" placeholder=\"Your token\" value=\"${page.token}\">\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <a id=\"getNewToken\" class=\"button is-info is-outlined is-fullwidth\">\n          <span class=\"icon\">\n            <i class=\"icon-arrows-cw\"></i>\n          </span>\n          <span>Request new token</span>\n        </a>\n      </div>\n    </div>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#getNewToken').addEventListener('click', event => {\n    const trigger = event.currentTarget\n    page.updateTrigger(trigger, 'loading')\n    axios.post('api/tokens/change').then(response => {\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          page.updateTrigger(trigger)\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      page.updateTrigger(trigger)\n      swal({\n        title: 'Woohoo!',\n        text: 'Your token was successfully changed.',\n        icon: 'success'\n      }).then(() => {\n        axios.defaults.headers.common.token = response.data.token\n        localStorage[lsKeys.token] = response.data.token\n        page.token = response.data.token\n        page.changeToken()\n      })\n    }).catch(error => {\n      page.updateTrigger(trigger)\n      page.onAxiosError(error)\n    })\n  })\n}\n\npage.changePassword = (params = {}) => {\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">New password:</label>\n        <div class=\"control\">\n          <input id=\"password\" class=\"input\" type=\"password\" min=\"6\" max=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <label class=\"label\">Re-type new password:</label>\n        <div class=\"control\">\n          <input id=\"passwordConfirm\" class=\"input\" type=\"password\" min=\"6\" max=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"sendChangePassword\" class=\"button is-info is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-paper-plane\"></i>\n            </span>\n            <span>Set new password</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#sendChangePassword').addEventListener('click', event => {\n    if (document.querySelector('#password').value === document.querySelector('#passwordConfirm').value)\n      page.sendNewPassword(document.querySelector('#password').value, event.currentTarget)\n    else\n      swal({\n        title: 'Password mismatch!',\n        text: 'Your passwords do not match, please try again.',\n        icon: 'error'\n      })\n  })\n}\n\npage.sendNewPassword = (pass, element) => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/password/change', { password: pass }).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(element)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    page.updateTrigger(element)\n    swal({\n      title: 'Woohoo!',\n      text: 'Your password was successfully changed.',\n      icon: 'success'\n    }).then(() => {\n      page.changePassword()\n    })\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getUsers = (params = {}) => {\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (params.pageNum === undefined)\n    params.pageNum = 0\n\n  if (!page.permissions.admin)\n    return swal('An error occurred!', 'You can not do this!', 'error')\n\n  const url = `api/users/${params.pageNum}`\n  axios.get(url).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    if (params.pageNum && (response.data.users.length === 0)) {\n      // Only remove loading class here, since beyond this the entire page will be replaced anyways\n      page.updateTrigger(params.trigger)\n      return swal('An error occurred!', `There are no more users to populate page ${params.pageNum + 1}.`, 'error')\n    }\n\n    page.currentView = 'users'\n    page.cache.users = {}\n\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    const extraControls = `\n      <div class=\"columns\">\n        <div class=\"column is-hidden-mobile\"></div>\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" value=\"${params.pageNum + 1}\">\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns is-hidden\">\n        <div class=\"column is-hidden-mobile\"></div>\n        <div class=\"column has-text-right\">\n          <a class=\"button is-small is-info\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning\" title=\"Bulk disable (WIP)\" data-action=\"bulk-disable-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n            <span>Bulk disable</span>\n          </a>\n          <a class=\"button is-small is-danger\" title=\"Bulk delete (WIP)\" data-action=\"bulk-delete-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    page.dom.innerHTML = `\n      ${pagination}\n      ${extraControls}\n      ${controls}\n      <div class=\"table-container\">\n        <table class=\"table is-narrow is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th class=\"is-hidden\"><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n              <th>ID</th>\n              <th>Username</th>\n              <th>Uploads</th>\n              <th>Usage</th>\n              <th>Group</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n      <hr>\n      ${pagination}\n    `\n\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < response.data.users.length; i++) {\n      const user = response.data.users[i]\n      const selected = page.selected.users.includes(user.id)\n      if (!selected) unselected = true\n\n      let displayGroup = null\n      const groups = Object.keys(user.groups)\n      for (let i = 0; i < groups.length; i++) {\n        if (!user.groups[groups[i]]) break\n        displayGroup = groups[i]\n      }\n\n      // Server-side explicitly expects either of these two values to consider a user as disabled\n      const enabled = user.enabled !== false && user.enabled !== 0\n      page.cache.users[user.id] = {\n        username: user.username,\n        groups: user.groups,\n        enabled,\n        displayGroup\n      }\n\n      const tr = document.createElement('tr')\n      tr.dataset.id = user.id\n      tr.innerHTML = `\n        <td class=\"controls is-hidden\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-action=\"select\"${selected ? ' checked' : ''}></td>\n        <th>${user.id}</th>\n        <th${enabled ? '' : ' class=\"is-linethrough\"'}>${user.username}</td>\n        <th>${user.uploads}</th>\n        <td>${page.getPrettyBytes(user.usage)}</td>\n        <td>${displayGroup}</td>\n        <td class=\"controls has-text-right\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit user\" data-action=\"edit-user\">\n            <span class=\"icon\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined\" title=\"${user.uploads ? 'View uploads' : 'User doesn\\'t have uploads'}\" data-action=\"view-user-uploads\" ${user.uploads ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-docs\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"${enabled ? 'Disable user' : 'User is disabled'}\" data-action=\"disable-user\" ${enabled ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined is-hidden\" title=\"Delete user (WIP)\" data-action=\"delete-user\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n      page.checkboxes.users = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n\n    page.views.users.pageNum = response.data.users.length ? params.pageNum : 0\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.editUser = id => {\n  const user = page.cache.users[id]\n  if (!user) return\n\n  const groupOptions = Object.keys(page.permissions).map((g, i, a) => {\n    const selected = g === user.displayGroup\n    const disabled = !(a[i + 1] && page.permissions[a[i + 1]])\n    return `<option value=\"${g}\"${selected ? ' selected' : ''}${disabled ? ' disabled' : ''}>${g}</option>`\n  }).join('\\n')\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Username</label>\n      <div class=\"controls\">\n        <input id=\"swalUsername\" class=\"input\" type=\"text\" value=\"${user.username || ''}\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">User group</label>\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalGroup\">\n            ${groupOptions}\n          </select>\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalEnabled\" type=\"checkbox\" ${user.enabled ? 'checked' : ''}>\n          Enabled\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalResetPassword\" type=\"checkbox\">\n          Reset password\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Edit user',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/edit', {\n      id,\n      username: document.querySelector('#swalUsername').value,\n      group: document.querySelector('#swalGroup').value,\n      enabled: document.querySelector('#swalEnabled').checked,\n      resetPassword: document.querySelector('#swalResetPassword').checked\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      if (response.data.password) {\n        const div = document.createElement('div')\n        div.innerHTML = `\n          <p><b>${user.username}</b>'s new password is:</p>\n          <p><code>${response.data.password}</code></p>\n        `\n        swal({\n          title: 'Success!',\n          icon: 'success',\n          content: div\n        })\n      } else if (response.data.update && response.data.update.username !== user.username) {\n        swal('Success!', `${user.username} was renamed into: ${response.data.update.name}.`, 'success')\n      } else {\n        swal('Success!', 'The user was edited!', 'success')\n      }\n\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.disableUser = id => {\n  const user = page.cache.users[id]\n  if (!user || !user.enabled) return\n\n  const content = document.createElement('div')\n  content.innerHTML = `You will be disabling a user with the username <b>${page.cache.users[id].username}</b>.`\n\n  swal({\n    title: 'Are you sure?',\n    icon: 'warning',\n    content,\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, disable them!',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/disable', { id }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided')\n          return page.verifyToken(page.token)\n        else\n          return swal('An error occurred!', response.data.description, 'error')\n\n      swal('Success!', 'The user has been disabled.', 'success')\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\n// Roughly based on https://github.com/mayuska/pagination/blob/master/index.js\npage.paginate = (totalItems, itemsPerPage, currentPage) => {\n  currentPage = currentPage + 1\n  const step = 3\n  const numPages = Math.ceil(totalItems / itemsPerPage)\n\n  let template = ''\n  const elementsToShow = step * 2\n  const add = {\n    pageNum (start, end) {\n      for (let i = start; i <= end; ++i)\n        template += `<li><a class=\"button pagination-link ${i === currentPage ? ' is-current' : ''}\" aria-label=\"Goto page ${i}\" data-action=\"page-goto\" data-goto=\"${i - 1}\">${i}</a></li>`\n    },\n    startDots () {\n      template += `\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page 1\" data-action=\"page-goto\" data-goto=\"0\">1</a></li>\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n      `\n    },\n    endDots () {\n      template += `\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page ${numPages}\" data-action=\"page-goto\" data-goto=\"${numPages - 1}\">${numPages}</a></li>\n      `\n    }\n  }\n\n  if (elementsToShow + 1 >= numPages) {\n    add.pageNum(1, numPages)\n  } else if (currentPage < elementsToShow) {\n    add.pageNum(1, elementsToShow)\n    add.endDots()\n  } else if (currentPage > numPages - elementsToShow + 1) {\n    add.startDots()\n    add.pageNum(numPages - elementsToShow + 1, numPages)\n  } else {\n    add.startDots()\n    add.pageNum(currentPage - step + 1, currentPage + step - 1)\n    add.endDots()\n  }\n\n  return `\n    <nav class=\"pagination is-centered is-small\">\n      <a class=\"button pagination-previous\" data-action=\"page-prev\">Previous</a>\n      <a class=\"button pagination-next\" data-action=\"page-next\">Next page</a>\n      <ul class=\"pagination-list\">${template}</ul>\n    </nav>\n  `\n}\n\npage.getStatistics = (params = {}) => {\n  if (!page.permissions.admin)\n    return swal('An error occurred!', 'You can not do this!', 'error')\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  const url = 'api/stats'\n  axios.get(url).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    let content = ''\n    const keys = Object.keys(response.data.stats)\n    for (let i = 0; i < keys.length; i++) {\n      let rows = ''\n      if (!response.data.stats[keys[i]])\n        rows += `\n          <tr>\n            <td>Generating, please try again later\\u2026</td>\n            <td></td>\n          </tr>\n        `\n      else\n        try {\n          const types = response.data.stats[keys[i]]._types || {}\n          const valKeys = Object.keys(response.data.stats[keys[i]])\n          for (let j = 0; j < valKeys.length; j++) {\n            // Skip keys that starts with an underscore\n            if (/^_/.test(valKeys[j]))\n              continue\n\n            const value = response.data.stats[keys[i]][valKeys[j]]\n            let parsed = value\n\n            // Parse values with some preset formatting\n            if ((types.number || []).includes(valKeys[j]))\n              parsed = value.toLocaleString()\n            if ((types.byte || []).includes(valKeys[j]))\n              parsed = page.getPrettyBytes(value)\n            if ((types.byteUsage || []).includes(valKeys[j]))\n              parsed = `${page.getPrettyBytes(value.used)} / ${page.getPrettyBytes(value.total)} (${Math.round(value.used / value.total * 100)}%)`\n\n            const string = valKeys[j]\n              .replace(/([A-Z])/g, ' $1')\n              .toUpperCase()\n            rows += `\n              <tr>\n                <th>${string}</th>\n                <td>${parsed}</td>\n              </tr>\n            `\n          }\n        } catch (error) {\n          rows = `\n              <tr>\n                <td>Error parsing response. Try again?</td>\n                <td></td>\n              </tr>\n            `\n          page.onError(error)\n        }\n\n      content += `\n        <div class=\"table-container\">\n          <table id=\"statistics\" class=\"table is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th>${keys[i].toUpperCase()}</th>\n                <td></td>\n              </tr>\n            </thead>\n            <tbody>\n              ${rows}\n            </tbody>\n          </table>\n        </div>\n      `\n    }\n\n    page.dom.innerHTML = content\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\nwindow.onload = () => {\n  // Polyfill Object.assign()\n  // eslint-disable-next-line compat/compat\n  if (typeof Object.assign !== 'function')\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, 'assign', {\n      value: function assign (target, varArgs) { // .length of function is 2\n        'use strict'\n        if (target === null || target === undefined)\n          throw new TypeError('Cannot convert undefined or null to object')\n        const to = Object(target)\n        for (let i = 1; i < arguments.length; i++) {\n          const nextSource = arguments[i]\n          if (nextSource !== null && nextSource !== undefined)\n            for (const nextKey in nextSource)\n              // Avoid bugs when hasOwnProperty is shadowed\n              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey))\n                to[nextKey] = nextSource[nextKey]\n        }\n        return to\n      },\n      writable: true,\n      configurable: true\n    })\n\n  // Add 'no-touch' class to non-touch devices\n  if (!('ontouchstart' in document.documentElement))\n    document.documentElement.classList.add('no-touch')\n\n  const selectedKeys = ['uploads', 'uploadsAll', 'users']\n  for (let i = 0; i < selectedKeys.length; i++) {\n    const ls = localStorage[lsKeys.selected[selectedKeys[i]]]\n    if (ls) page.selected[selectedKeys[i]] = JSON.parse(ls)\n  }\n\n  page.preparePage()\n\n  page.clipboardJS = new ClipboardJS('.clipboard-js')\n\n  page.clipboardJS.on('success', () => {\n    return swal('Copied!', 'The link has been copied to clipboard.', 'success')\n  })\n\n  page.clipboardJS.on('error', page.onError)\n\n  page.lazyLoad = new LazyLoad()\n}\n"]}