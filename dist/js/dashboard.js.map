{"version":3,"sources":["dashboard.js"],"names":["const","lsKeys","token","viewType","uploads","uploadsAll","selected","users","page","section","dom","localStorage","username","permissions","menusContainer","menus","currentView","views","type","album","pageNum","filters","all","checkboxes","lastSelected","upload","user","selectAlbumContainer","cache","albums","clipboardJS","lazyLoad","imageExts","videoExts","isSomethingLoading","fadingIn","albumTitleMaxLength","albumDescMaxLength","unhide","document","querySelector","classList","add","remove","onError","error","console","content","createElement","innerHTML","toString","swal","title","icon","onAxiosError","statusText","520","521","522","523","524","525","526","527","530","response","status","description","data","preparePage","verifyToken","window","location","checkClientVersion","apiVersion","match","src","text","buttons","confirm","closeModal","then","reload","reloadOnError","axios","post","success","removeItem","defaults","headers","common","version","prepareDashboard","catch","addEventListener","domClick","event","target","contains","preventDefault","itemMenus","selector","onclick","getUploads","deleteUploadsByNames","getAlbums","changeToken","changePassword","logout","params","group","getStatistics","getUsers","loop","i","item","warnSomethingLoading","call","Object","assign","trigger","currentTarget","push","length","moderator","getAlbumsSidebar","prepareShareX","updateTrigger","timer","newState","parentNode","tagName","let","getItemID","element","parent","parseInt","dataset","id","includes","action","hasAttribute","stopPropagation","setUploadsView","addToAlbum","deleteUpload","addSelectedUploadsToAlbum","bulkDeleteUploads","displayPreview","uploadFiltersHelp","filterUploads","submitAlbum","editAlbum","deleteAlbum","createUser","editUser","disableUser","deleteUser","viewUserUploads","getNewToken","clearSelection","select","selectAll","focusJumpToPage","switchPage","fadeAndScroll","disableFading","clearTimeout","setTimeout","scrollIntoView","behavior","block","inline","func","goto","jumpToPage","jumpid","checkValidity","parsed","value","isNaN","focus","url","undefined","minOffset","Date","getTimezoneOffset","get","pages","Math","ceil","count","files","autoPage","basedomain","pagination","paginate","extraControls","escape","controls","bottomExtraControls","replace","bottomPagination","unselected","hasExpiryDateColumn","some","file","expirydate","thumb","exec","extname","toLowerCase","name","original","prettyBytes","getPrettyBytes","size","prettyDate","getPrettyDate","timestamp","prettyExpiryDate","appendix","userid","albumid","table","div","className","appendChild","querySelectorAll","allAlbums","tr","ip","checked","update","view","isimage","isvideo","onload","body","onerror","video","autoplay","insertAdjacentElement","splice","indexOf","JSON","stringify","selectInBetween","lastElement","thisIndex","index","lastIndex","abs","shiftKey","suffix","substring","proceed","Boolean","style","trim","filtersid","postBulkDeleteUploads","field","values","cb","failed","filter","textArea","seen","names","split","map","trimmed","test","prototype","hasOwnProperty","join","objective","dangerMode","cancel","fields","Array","isArray","addUploadsToAlbum","ids","callback","choose","added","list","getElementsByTagName","removeAttribute","homeDomain","albumUrl","download","public","requestLink","identifier","purge","albumsContainer","oldAlbums","li","a","sendNewPassword","pass","password","admin","max","displayGroup","groups","keys","enabled","registration","prettyTokenUpdate","usage","groupOptions","g","resetPassword","autoClose","displayName","totalItems","itemsPerPage","currentPage","numPages","template","start","end","elementsToShow","step","stats","rows","types","_types","valKeys","j","number","toLocaleString","byte","byteUsage","used","total","round","s","toUpperCase","defineProperty","varArgs","arguments$1","arguments","TypeError","to","nextSource","nextKey","writable","configurable","documentElement","selectedKeys","ls","parse","ClipboardJS","on","LazyLoad"],"mappings":"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","file":"dashboard.js","sourcesContent":["/* global swal, axios, ClipboardJS, LazyLoad */\n\nconst lsKeys = {\n  token: 'token',\n  viewType: {\n    uploads: 'viewTypeUploads',\n    uploadsAll: 'viewTypeUploadsAll'\n  },\n  selected: {\n    uploads: 'selectedUploads',\n    uploadsAll: 'selectedUploadsAll',\n    users: 'selectedUsers'\n  }\n}\n\nconst page = {\n  // #dashboard\n  section: null,\n  // #page\n  dom: null,\n\n  // user token\n  token: localStorage[lsKeys.token],\n\n  // from api/tokens/verify\n  username: null,\n  permissions: null,\n\n  // sidebar menus\n  menusContainer: null,\n  menus: [],\n\n  currentView: null,\n  views: {\n    // config of uploads view\n    uploads: {\n      type: localStorage[lsKeys.viewType.uploads],\n      album: null, // album's id\n      pageNum: null // page num\n    },\n    // config of uploads view (all)\n    uploadsAll: {\n      type: localStorage[lsKeys.viewType.uploadsAll],\n      filters: null, // uploads' filters\n      pageNum: null, // page num\n      all: true\n    },\n    // config of users view\n    users: {\n      filters: null, // users' filters\n      pageNum: null\n    }\n  },\n\n  // id of selected items (shared across pages and will be synced with localStorage)\n  selected: {\n    uploads: [],\n    uploadsAll: [],\n    users: []\n  },\n  checkboxes: {\n    uploads: [],\n    uploadsAll: [],\n    users: []\n  },\n  lastSelected: {\n    upload: null,\n    uploadsAll: null,\n    user: null\n  },\n\n  // select album dom for dialogs/modals\n  selectAlbumContainer: null,\n\n  // cache for dialogs/modals\n  cache: {\n    uploads: {},\n    albums: {},\n    users: {}\n  },\n\n  clipboardJS: null,\n  lazyLoad: null,\n\n  imageExts: ['.webp', '.jpg', '.jpeg', '.gif', '.png', '.tiff', '.tif', '.svg'],\n  // TODO: Disable \"Load original\" button with non-streamable extensions\n  videoExts: ['.webm', '.mp4', '.wmv', '.avi', '.mov', '.mkv', '.m4v', '.m2ts'],\n\n  isSomethingLoading: false,\n  fadingIn: null,\n\n  albumTitleMaxLength: 70,\n  albumDescMaxLength: 4000\n}\n\npage.unhide = () => {\n  document.querySelector('#loader').classList.add('is-hidden')\n  page.section.classList.remove('is-hidden')\n}\n\n// Handler for regular JS errors\npage.onError = error => {\n  console.error(error)\n\n  const content = document.createElement('div')\n  content.innerHTML = `<code>${error.toString()}</code>`\n  return swal({\n    title: 'An error occurred!',\n    icon: 'error',\n    content\n  })\n}\n\n// Handler for Axios errors\npage.onAxiosError = error => {\n  console.error(error)\n\n  // Better Cloudflare errors\n  const cloudflareErrors = {\n    520: 'Unknown Error',\n    521: 'Web Server Is Down',\n    522: 'Connection Timed Out',\n    523: 'Origin Is Unreachable',\n    524: 'A Timeout Occurred',\n    525: 'SSL Handshake Failed',\n    526: 'Invalid SSL Certificate',\n    527: 'Railgun Error',\n    530: 'Origin DNS Error'\n  }\n\n  const statusText = cloudflareErrors[error.response.status] || error.response.statusText\n  const description = error.response.data && error.response.data.description\n    ? error.response.data.description\n    : 'There was an error with the request, please check the console for more information.'\n\n  return swal(`${error.response.status} ${statusText}`, description, 'error')\n}\n\npage.preparePage = () => {\n  if (page.token)\n    page.verifyToken(page.token, true)\n  else\n    window.location = 'auth'\n}\n\npage.checkClientVersion = apiVersion => {\n  const self = document.querySelector('#mainScript')\n  const match = self.src.match(/\\?_=(\\d+)$/)\n  if (match && match[1] && match[1] !== apiVersion)\n    return swal({\n      title: 'Updated detected!',\n      text: 'Client assets have been updated. Reload to display the latest version?',\n      icon: 'info',\n      buttons: {\n        confirm: {\n          text: 'Reload',\n          closeModal: false\n        }\n      }\n    }).then(() => {\n      location.reload()\n    })\n}\n\npage.verifyToken = (token, reloadOnError) => {\n  axios.post('api/tokens/verify', { token }).then(response => {\n    if (response.data.success === false)\n      return swal({\n        title: 'An error occurred!',\n        text: response.data.description,\n        icon: 'error'\n      }).then(() => {\n        if (!reloadOnError) return\n        localStorage.removeItem(lsKeys.token)\n        window.location = 'auth'\n      })\n\n    axios.defaults.headers.common.token = token\n    localStorage[lsKeys.token] = token\n\n    if (response.data.version)\n      page.checkClientVersion(response.data.version)\n\n    page.token = token\n    page.username = response.data.username\n    page.permissions = response.data.permissions\n    page.prepareDashboard()\n  }).catch(page.onAxiosError)\n}\n\npage.prepareDashboard = () => {\n  page.section = document.querySelector('#dashboard')\n  page.dom = page.section.querySelector('#page')\n\n  // Capture all click events\n  page.dom.addEventListener('click', page.domClick, true)\n\n  // Capture all submit events\n  page.dom.addEventListener('submit', event => {\n    // Prevent default if necessary\n    if (event.target && event.target.classList.contains('prevent-default'))\n      return event.preventDefault()\n  }, true)\n\n  page.menusContainer = document.querySelector('#menu')\n\n  // All item menus in the sidebar\n  const itemMenus = [\n    { selector: '#itemUploads', onclick: page.getUploads },\n    { selector: '#itemDeleteUploadsByNames', onclick: page.deleteUploadsByNames },\n    { selector: '#itemManageAlbums', onclick: page.getAlbums },\n    { selector: '#itemManageToken', onclick: page.changeToken },\n    { selector: '#itemChangePassword', onclick: page.changePassword },\n    { selector: '#itemLogout', onclick: page.logout },\n    { selector: '#itemManageUploads', onclick: page.getUploads, params: { all: true }, group: 'moderator' },\n    { selector: '#itemStatistics', onclick: page.getStatistics, group: 'admin' },\n    { selector: '#itemManageUsers', onclick: page.getUsers, group: 'admin' }\n  ]\n\n  for (let i = 0; i < itemMenus.length; i++) {\n    // Skip item menu if not enough permission\n    if (itemMenus[i].group && !page.permissions[itemMenus[i].group])\n      continue\n\n    // Add onclick event listener\n    const item = document.querySelector(itemMenus[i].selector)\n    item.addEventListener('click', event => {\n      if (page.isSomethingLoading)\n        return page.warnSomethingLoading()\n\n      // eslint-disable-next-line compat/compat\n      itemMenus[i].onclick.call(null, Object.assign(itemMenus[i].params || {}, {\n        trigger: event.currentTarget\n      }))\n    })\n\n    item.classList.remove('is-hidden')\n    page.menus.push(item)\n  }\n\n  // If at least a moderator, show administration section\n  if (page.permissions.moderator) {\n    document.querySelector('#itemLabelAdmin').classList.remove('is-hidden')\n    document.querySelector('#itemListAdmin').classList.remove('is-hidden')\n  }\n\n  // Update text of logout button\n  document.querySelector('#itemLogout').innerHTML = `Logout ( ${page.username} )`\n\n  // Finally display dashboard\n  page.unhide()\n\n  // Load albums sidebar\n  page.getAlbumsSidebar()\n\n  if (typeof page.prepareShareX === 'function')\n    page.prepareShareX()\n}\n\npage.logout = params => {\n  page.updateTrigger(params.trigger, 'active')\n  localStorage.removeItem(lsKeys.token)\n  window.location = 'auth'\n}\n\npage.warnSomethingLoading = () => {\n  swal('Please wait!', 'Something else is still loading\\u2026', 'warning', {\n    buttons: false,\n    timer: 3000\n  })\n}\n\npage.updateTrigger = (trigger, newState) => {\n  if (!trigger) return\n\n  // Disable menus container and pagination when loading\n  if (newState === 'loading') {\n    page.isSomethingLoading = true\n    page.section.classList.add('is-loading')\n  } else {\n    page.section.classList.remove('is-loading')\n    page.isSomethingLoading = false\n  }\n\n  if (newState === 'loading') {\n    trigger.classList.add('is-loading')\n  } else if (newState === 'active') {\n    if (trigger.parentNode.tagName !== 'LI')\n      return\n    for (let i = 0; i < page.menus.length; i++)\n      page.menus[i].classList.remove('is-active')\n    trigger.classList.remove('is-loading')\n    trigger.classList.add('is-active')\n  } else {\n    trigger.classList.remove('is-loading')\n    trigger.classList.remove('is-active')\n  }\n}\n\npage.getItemID = element => {\n  // This expects the item's parent to have the item's ID\n  let parent = element.parentNode\n  // If the element is part of a set of controls, use the container's parent instead\n  if (element.parentNode.classList.contains('controls')) parent = parent.parentNode\n  return parseInt(parent.dataset.id)\n}\n\npage.domClick = event => {\n  // We are processing clicks this way to avoid using \"onclick\" attribute\n  // Apparently we will need to use \"unsafe-inline\" for \"script-src\" directive\n  // of Content Security Policy (CSP), if we want to use \"onclick\" attribute\n  // Though I think that only applies to some browsers (?)\n  // Of course it wouldn't have mattered if we didn't use CSP to begin with\n  // Anyway, I personally would rather not use \"onclick\" attribute\n  let element = event.target\n  if (!element) return\n\n  // Delegate click events to their A or BUTTON parents\n  if (['I'].includes(element.tagName) && ['SPAN'].includes(element.parentNode.tagName))\n    element = element.parentNode\n  if (['SPAN'].includes(element.tagName) && ['A', 'BUTTON'].includes(element.parentNode.tagName))\n    element = element.parentNode\n\n  // Skip elements that have no action data\n  if (!element.dataset || !element.dataset.action) return\n\n  // Skip disabled elements\n  if (element.hasAttribute('disabled')) return\n\n  event.stopPropagation() // maybe necessary\n  const id = page.getItemID(element)\n  const action = element.dataset.action\n\n  switch (action) {\n    // Uploads\n    case 'view-list':\n      return page.setUploadsView('list', element)\n    case 'view-thumbs':\n      return page.setUploadsView('thumbs', element)\n    case 'add-to-album':\n      return page.addToAlbum(id)\n    case 'delete-upload':\n      return page.deleteUpload(id)\n    case 'add-selected-uploads-to-album':\n      return page.addSelectedUploadsToAlbum()\n    case 'bulk-delete-uploads':\n      return page.bulkDeleteUploads()\n    case 'display-preview':\n      return page.displayPreview(id)\n    // Manage uploads\n    case 'upload-filters-help':\n      return page.uploadFiltersHelp(element)\n    case 'filter-uploads':\n      return page.filterUploads(element)\n    // Manage your albums\n    case 'submit-album':\n      return page.submitAlbum(element)\n    case 'edit-album':\n      return page.editAlbum(id)\n    case 'delete-album':\n      return page.deleteAlbum(id)\n    // Manage users\n    case 'create-user':\n      return page.createUser()\n    case 'edit-user':\n      return page.editUser(id)\n    case 'disable-user':\n      return page.disableUser(id)\n    case 'delete-user':\n      return page.deleteUser(id)\n    case 'view-user-uploads':\n      return page.viewUserUploads(id, element)\n    /* // WIP\n    case 'user-filters-help':\n      return page.userFiltersHelp(element)\n    case 'filter-users':\n      return page.filterUsers(element)\n    */\n    // Others\n    case 'get-new-token':\n      return page.getNewToken(element)\n    // Uploads & Users\n    case 'clear-selection':\n      return page.clearSelection()\n    case 'select':\n      return page.select(element, event)\n    case 'select-all':\n      return page.selectAll(element)\n    case 'page-ellipsis':\n      return page.focusJumpToPage(element)\n    case 'page-prev':\n    case 'page-next':\n    case 'page-goto':\n    case 'jump-to-page':\n      return page.switchPage(action, element)\n  }\n}\n\npage.fadeAndScroll = disableFading => {\n  if (page.fadingIn) {\n    clearTimeout(page.fadingIn)\n    page.dom.classList.remove('fade-in')\n  }\n\n  if (!disableFading) {\n    page.dom.classList.add('fade-in')\n    page.fadingIn = setTimeout(() => {\n      page.dom.classList.remove('fade-in')\n    }, 500)\n  }\n\n  page.dom.scrollIntoView({\n    behavior: disableFading ? 'auto' : 'smooth',\n    block: 'start',\n    inline: 'nearest'\n  })\n}\n\npage.switchPage = (action, element) => {\n  if (page.isSomethingLoading)\n    return page.warnSomethingLoading()\n\n  // eslint-disable-next-line compat/compat\n  const params = Object.assign(page.views[page.currentView], {\n    trigger: element\n  })\n\n  const func = page.currentView === 'users' ? page.getUsers : page.getUploads\n\n  switch (action) {\n    case 'page-prev':\n      params.pageNum = page.views[page.currentView].pageNum - 1\n      if (params.pageNum < 0)\n        return swal('An error occurred!', 'This is already the first page.', 'error')\n      return func(params)\n    case 'page-next':\n      params.pageNum = page.views[page.currentView].pageNum + 1\n      return func(params)\n    case 'page-goto':\n      params.pageNum = parseInt(element.dataset.goto)\n      return func(params)\n    case 'jump-to-page': {\n      const jumpToPage = document.querySelector(`#${element.dataset.jumpid || 'jumpToPage'}`)\n      if (!jumpToPage.checkValidity()) return\n      const parsed = parseInt(jumpToPage.value)\n      params.pageNum = isNaN(parsed) ? 0 : (parsed - 1)\n      if (params.pageNum < 0) params.pageNum = 0\n      return func(params)\n    }\n  }\n}\n\npage.focusJumpToPage = element => {\n  const jumpToPage = document.querySelector(`#${element.dataset.jumpid || 'jumpToPage'}`)\n  if (!jumpToPage) return\n  jumpToPage.focus()\n  jumpToPage.select()\n}\n\npage.getUploads = (params = {}) => {\n  if (params && params.all && !page.permissions.moderator)\n    return swal('An error occurred!', 'You cannot do this!', 'error')\n\n  if (page.isSomethingLoading)\n    return page.warnSomethingLoading()\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (typeof params.pageNum !== 'number' || params.pageNum < 0)\n    params.pageNum = 0\n\n  const url = params.album !== undefined\n    ? `api/album/${params.album}/${params.pageNum}`\n    : `api/uploads/${params.pageNum}`\n\n  const headers = {\n    all: params.all ? '1' : '',\n    filters: params.filters || ''\n  }\n\n  // Send client timezone offset if using filters\n  // Server will pretend client is on UTC if missing\n  if (headers.filters)\n    headers.minOffset = new Date().getTimezoneOffset()\n\n  axios.get(url, { headers }).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const pages = Math.ceil(response.data.count / 25)\n    const files = response.data.files\n    if (params.pageNum && (files.length === 0))\n      if (params.autoPage) {\n        params.pageNum = pages - 1\n        return page.getUploads(params)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', `There are no more uploads to populate page ${params.pageNum + 1}.`, 'error')\n      }\n\n    page.currentView = params.all ? 'uploadsAll' : 'uploads'\n    page.cache.uploads = {}\n\n    const albums = response.data.albums\n    const users = response.data.users\n    const basedomain = response.data.basedomain\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    const filter = `\n      <div class=\"column\">\n        <form class=\"prevent-default\">\n          <div class=\"field has-addons\">\n            <div class=\"control is-expanded\">\n              <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filters\" value=\"${page.escape(params.filters || '')}\">\n            </div>\n            <div class=\"control\">\n              <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help?\" data-action=\"upload-filters-help\"${params.all ? ' data-all=\"true\"' : ''}>\n                <span class=\"icon\">\n                  <i class=\"icon-help-circled\"></i>\n                </span>\n              </button>\n            </div>\n            <div class=\"control\">\n              <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter uploads\" data-action=\"filter-uploads\">\n                <span class=\"icon\">\n                  <i class=\"icon-filter\"></i>\n                </span>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" min=\"1\" max=\"${pages}\" value=\"${params.pageNum + 1}\"${pages === 1 ? ' disabled' : ''}>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column is-hidden-mobile\"></div>\n        <div class=\"column has-text-centered\">\n          <a class=\"button is-small is-danger is-outlined\" title=\"List view\" data-action=\"view-list\">\n            <span class=\"icon\">\n              <i class=\"icon-th-list\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Thumbs view\" data-action=\"view-thumbs\">\n            <span class=\"icon\">\n              <i class=\"icon-th-large\"></i>\n            </span>\n          </a>\n        </div>\n        <div class=\"column bulk-operations has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          ${params.all ? '' : `\n          <a class=\"button is-small is-warning is-outlined\" title=\"Bulk add to album\" data-action=\"add-selected-uploads-to-album\">\n            <span class=\"icon\">\n              <i class=\"icon-plus\"></i>\n            </span>\n          </a>`}\n          <a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete\" data-action=\"bulk-delete-uploads\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Do some string replacements for bottom controls\n    const bottomFiltersId = 'bFilters'\n    const bottomJumpId = 'bJumpToPage'\n    const bottomExtraControls = extraControls\n      .replace(/id=\"filters\"/, `id=\"${bottomFiltersId}\"`)\n      .replace(/(data-action=\"filter-uploads\")/, `$1 data-filtersid=\"${bottomFiltersId}\"`)\n      .replace(/id=\"jumpToPage\"/, `id=\"${bottomJumpId}\"`)\n      .replace(/(data-action=\"jump-to-page\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n    const bottomPagination = pagination\n      .replace(/(data-action=\"page-ellipsis\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    const hasExpiryDateColumn = files.some(file => {\n      return file.expirydate !== undefined\n    })\n\n    for (let i = 0; i < files.length; i++) {\n      // Build full URLs\n      files[i].file = `${basedomain}/${files[i].name}`\n      if (files[i].thumb)\n        files[i].thumb = `${basedomain}/${files[i].thumb}`\n\n      // Determine types\n      files[i].type = 'other'\n      const exec = /.[\\w]+(\\?|$)/.exec(files[i].file)\n      const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n      if (page.imageExts.includes(extname))\n        files[i].type = 'picture'\n      else if (page.videoExts.includes(extname))\n        files[i].type = 'video'\n\n      // Cache bare minimum data for thumbnails viewer\n      page.cache.uploads[files[i].id] = {\n        name: files[i].name,\n        thumb: files[i].thumb,\n        original: files[i].file,\n        type: files[i].type\n      }\n\n      // Prettify\n      files[i].prettyBytes = page.getPrettyBytes(parseInt(files[i].size))\n      files[i].prettyDate = page.getPrettyDate(new Date(files[i].timestamp * 1000))\n\n      if (hasExpiryDateColumn)\n        files[i].prettyExpiryDate = files[i].expirydate\n          ? page.getPrettyDate(new Date(files[i].expirydate * 1000))\n          : null\n\n      // Update selected status\n      files[i].selected = page.selected[page.currentView].includes(files[i].id)\n      if (!files[i].selected) unselected = true\n\n      // Appendix (display album or user)\n      if (params.all)\n        files[i].appendix = files[i].userid\n          ? users[files[i].userid] || ''\n          : ''\n      else if (params.album === undefined)\n        files[i].appendix = files[i].albumid\n          ? albums[files[i].albumid] || ''\n          : ''\n    }\n\n    if (page.views[page.currentView].type === 'thumbs') {\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div id=\"table\" class=\"columns is-multiline is-mobile is-centered\">\n        </div>\n        ${controls}\n        ${bottomExtraControls}\n        ${bottomPagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const div = document.createElement('div')\n        div.className = 'image-container column'\n        div.dataset.id = upload.id\n\n        if (upload.thumb !== undefined)\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\"><img alt=\"${upload.name}\" data-src=\"${upload.thumb}\"/></a>`\n        else\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\"><h1 class=\"title\">${upload.extname || 'N/A'}</h1></a>`\n\n        div.innerHTML += `\n          <input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}>\n          <div class=\"controls\">\n            ${upload.thumb ? `\n            <a class=\"button is-small is-primary\" title=\"Display preview\" data-action=\"display-preview\">\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>` : ''}\n            <a class=\"button is-small is-info clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-warning\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-danger\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </div>\n          <div class=\"details\">\n            <p><span class=\"name\">${upload.name}</span></p>\n            <p>${upload.appendix ? `<span>${upload.appendix}</span> – ` : ''}${upload.prettyBytes}</p>\n            ${hasExpiryDateColumn && upload.prettyExpiryDate ? `\n            <p class=\"expirydate\">EXP: ${upload.prettyExpiryDate}</p>` : ''}\n          </div>\n        `\n\n        table.appendChild(div)\n        page.checkboxes[page.currentView] = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n      }\n    } else {\n      const allAlbums = params.all && params.filters && params.filters.includes('albumid:')\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div class=\"table-container\">\n          <table class=\"table is-narrow is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n                <th title=\"Key: name\">File name</th>\n                ${params.album === undefined ? `<th title=\"Key: ${params.all ? 'userid\">User' : 'albumid\">Album'}</th>` : ''}\n                ${allAlbums ? '<th title=\"Key: albumid\">Album</th>' : ''}\n                <th title=\"Key: size\">Size</th>\n                ${params.all ? '<th title=\"Key: ip\">IP</th>' : ''}\n                <th title=\"Key: timestamp\">Upload date</th>\n                ${hasExpiryDateColumn ? '<th title=\"Key: expirydate\">Expiry date</th>' : ''}\n                <th></th>\n              </tr>\n            </thead>\n            <tbody id=\"table\">\n            </tbody>\n          </table>\n        </div>\n        ${controls}\n        ${bottomExtraControls}\n        ${bottomPagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const tr = document.createElement('tr')\n        tr.dataset.id = upload.id\n        tr.innerHTML = `\n          <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}></td>\n          <th><a href=\"${upload.file}\" target=\"_blank\" title=\"${upload.file}\">${upload.name}</a></th>\n          ${params.album === undefined ? `<th>${upload.appendix}</th>` : ''}\n          ${allAlbums ? `<th>${files[i].albumid ? (albums[files[i].albumid] || '') : ''}</th>` : ''}\n          <td>${upload.prettyBytes}</td>\n          ${params.all ? `<td>${upload.ip || ''}</td>` : ''}\n          <td>${upload.prettyDate}</td>\n          ${hasExpiryDateColumn ? `<td>${upload.prettyExpiryDate || '-'}</td>` : ''}\n          <td class=\"controls has-text-right\">\n            <a class=\"button is-small is-primary is-outlined\" title=\"${upload.thumb ? 'Display preview' : 'File can\\'t be previewed'}\" data-action=\"display-preview\"${upload.thumb ? '' : ' disabled'}>\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            ${params.all ? '' : `\n            <a class=\"button is-small is-warning is-outlined\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>`}\n            <a class=\"button is-small is-danger is-outlined\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </td>\n        `\n\n        table.appendChild(tr)\n        page.checkboxes[page.currentView] = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n      }\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected && files.length) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    if (page.views[page.currentView].type === 'thumbs') {\n      page.fadeAndScroll(true)\n      page.lazyLoad.update()\n    } else {\n      page.fadeAndScroll()\n    }\n\n    page.updateTrigger(params.trigger, 'active')\n\n    if (page.currentView === 'uploads')\n      page.views.uploads.album = params.album\n    if (page.currentView === 'uploadsAll')\n      page.views.uploadsAll.filters = params.filters\n    page.views[page.currentView].pageNum = files.length ? params.pageNum : 0\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.setUploadsView = (view, element) => {\n  if (page.isSomethingLoading)\n    return page.warnSomethingLoading()\n\n  localStorage[lsKeys.viewType[page.currentView]] = view\n  page.views[page.currentView].type = view\n\n  // eslint-disable-next-line compat/compat\n  page.getUploads(Object.assign(page.views[page.currentView], {\n    trigger: element\n  }))\n}\n\npage.displayPreview = id => {\n  const file = page.cache.uploads[id]\n  if (!file.thumb) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field has-text-centered\">\n      <label class=\"label\">${file.name}</label>\n      <div class=\"controls swal-display-thumb-container\">\n        <img id=\"swalThumb\" src=\"${file.thumb}\">\n      </div>\n    </div>\n  `\n\n  if (file.original) {\n    const exec = /.[\\w]+(\\?|$)/.exec(file.original)\n    const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n    const isimage = page.imageExts.includes(extname)\n    const isvideo = !isimage && page.videoExts.includes(extname)\n\n    if (isimage || isvideo) {\n      div.innerHTML += `\n        <div class=\"field has-text-centered\">\n          <div class=\"controls\">\n            <a id=\"swalOriginal\" type=\"button\" class=\"button is-info is-outlined is-fullwidth\" data-original=\"${file.original}\">\n              <span class=\"icon\">\n                <i class=\"icon-arrows-cw\"></i>\n              </span>\n              <span>Load original</span>\n            </a>\n          </div>\n        </div>\n      `\n\n      div.querySelector('#swalOriginal').addEventListener('click', event => {\n        const trigger = event.currentTarget\n        if (trigger.classList.contains('is-danger'))\n          return\n\n        trigger.classList.add('is-loading')\n        const thumb = div.querySelector('#swalThumb')\n\n        if (isimage) {\n          thumb.src = file.original\n          thumb.onload = () => {\n            trigger.classList.add('is-hidden')\n            document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n          }\n          thumb.onerror = event => {\n            event.currentTarget.classList.add('is-hidden')\n            trigger.className = 'button is-danger is-fullwidth'\n            trigger.innerHTML = `\n              <span class=\"icon\">\n                <i class=\"icon-block\"></i>\n              </span>\n              <span>Unable to load original</span>\n            `\n          }\n        } else if (isvideo) {\n          thumb.classList.add('is-hidden')\n          const video = document.createElement('video')\n          video.id = 'swalVideo'\n          video.controls = true\n          video.autoplay = true\n          video.src = file.original\n          thumb.insertAdjacentElement('afterend', video)\n\n          trigger.classList.add('is-hidden')\n          document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n        }\n      })\n    }\n  }\n\n  return swal({\n    content: div,\n    buttons: false\n  }).then(() => {\n  // Destroy video, if necessary\n    const video = div.querySelector('#swalVideo')\n    if (video) video.remove()\n\n    // Restore modal size\n    document.body.querySelector('.swal-overlay .swal-modal').classList.remove('is-expanded')\n  })\n}\n\npage.selectAll = element => {\n  for (let i = 0; i < page.checkboxes[page.currentView].length; i++) {\n    const id = page.getItemID(page.checkboxes[page.currentView][i])\n    if (isNaN(id)) continue\n    if (page.checkboxes[page.currentView][i].checked !== element.checked) {\n      page.checkboxes[page.currentView][i].checked = element.checked\n      if (page.checkboxes[page.currentView][i].checked)\n        page.selected[page.currentView].push(id)\n      else\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n    }\n  }\n\n  if (page.selected[page.currentView].length)\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  else\n    delete localStorage[lsKeys.selected[page.currentView]]\n\n  element.title = element.checked ? 'Unselect all' : 'Select all'\n}\n\npage.selectInBetween = (element, lastElement) => {\n  const thisIndex = parseInt(element.dataset.index)\n  const lastIndex = parseInt(lastElement.dataset.index)\n\n  const distance = Math.abs(thisIndex - lastIndex)\n  if (distance < 2)\n    return\n\n  for (let i = 0; i < page.checkboxes[page.currentView].length; i++)\n    if ((thisIndex > lastIndex && i > lastIndex && i < thisIndex) ||\n      (thisIndex < lastIndex && i > thisIndex && i < lastIndex)) {\n      // Check or uncheck depending on the state of the initial checkbox\n      const checked = page.checkboxes[page.currentView][i].checked = lastElement.checked\n      const id = page.getItemID(page.checkboxes[page.currentView][i])\n      if (!page.selected[page.currentView].includes(id) && checked)\n        page.selected[page.currentView].push(id)\n      else if (page.selected[page.currentView].includes(id) && !checked)\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n    }\n}\n\npage.select = (element, event) => {\n  const id = page.getItemID(element)\n  if (isNaN(id)) return\n\n  const lastSelected = page.lastSelected[page.currentView]\n  if (event.shiftKey && lastSelected) {\n    page.selectInBetween(element, lastSelected)\n    // Check or uncheck depending on the state of the initial checkbox\n    element.checked = lastSelected.checked\n  } else {\n    page.lastSelected[page.currentView] = element\n  }\n\n  if (!page.selected[page.currentView].includes(id) && element.checked)\n    page.selected[page.currentView].push(id)\n  else if (page.selected[page.currentView].includes(id) && !element.checked)\n    page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n\n  // Update local storage\n  if (page.selected[page.currentView].length)\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  else\n    delete localStorage[lsKeys.selected[page.currentView]]\n}\n\npage.clearSelection = () => {\n  const selected = page.selected[page.currentView]\n  const type = page.currentView === 'users' ? 'users' : 'uploads'\n  const count = selected.length\n  if (!count)\n    return swal('An error occurred!', `You have not selected any ${type}.`, 'error')\n\n  const suffix = count === 1 ? type.substring(0, type.length - 1) : type\n  return swal({\n    title: 'Are you sure?',\n    text: `You are going to unselect ${count} ${suffix}.`,\n    buttons: true\n  }).then(proceed => {\n    if (!proceed) return\n\n    const checkboxes = page.checkboxes[page.currentView]\n    for (let i = 0; i < checkboxes.length; i++)\n      if (checkboxes[i].checked)\n        checkboxes[i].checked = false\n\n    page.selected[page.currentView] = []\n    delete localStorage[lsKeys.selected[page.currentView]]\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll) selectAll.checked = false\n\n    return swal('Cleared selection!', `Unselected ${count} ${suffix}.`, 'success')\n  })\n}\n\npage.uploadFiltersHelp = element => {\n  const all = Boolean(element.dataset.all)\n  const content = document.createElement('div')\n  content.style = 'text-align: left'\n  content.innerHTML = `${all ? `\n    There are 2 filter keys, namely <b>user</b> (username) and <b>ip</b>.\n    These keys can be specified more than once.\n    For usernames with whitespaces, wrap them with double quotes (<code>\"</code>).\n    Special cases such as uploads by non-registered users or have no IPs respectively, use <code>user:-</code> or <code>ip:-</code>.\n\n    To exclude certain users/ips while still listing every other uploads, add negation sign (<code>-</code>) before the keys.\n    Negation sign can also be used to exclude the special cases mentioned above (i.e. <code>-user:-</code> or <code>-ip:-</code>).\n\n    If you know the ID of a user's album, you can list its uploads with <b>albumid</b> key.\n    Negation sign works for this key as well.\n    ` : `\n    There is only 1 filter key, namely <b>albumid</b>.\n    This key can be specified more than once.\n    Special case such as uploads with no albums, use <code>albumid:-</code>.\n\n    To exclude certain albums while still listing every other uploads, add negation sign (<code>-</code>) before the keys.\n    Negation sign can also be used to exclude the special case mentioned above (i.e. <code>-albumid:-</code>).\n    `}\n    There are 2 range keys: <b>date</b> (upload date) and <b>expiry</b> (expiry date).\n    Their format is: <code>YYYY/MM/DD HH:MM:SS-YYYY/MM/DD HH:MM:SS</code> (\"from\" date and \"to\" date respectively).\n    You may specify only one of the dates.\n    If \"to\" date is missing, 'now' will be used.\n    If \"from\" date is missing, 'beginning of time' will be used.\n    If any of the subsequent date or time units are not specified, their first value will be used (e.g. January for month, 1 for day, and so on).\n    If only time is specified, today's date will be used.\n    In conclusion, the following examples are all valid: <code>date:2020/01/01 01:23-2018/01/01 06</code>, <code>expiry:-2020/05</code>, <code>date:12:34:56</code>.\n    These keys can only be specified once each.\n\n    <b>Timezone?</b> Don't fret, feel free to query the dates with your own timezone!\n    API requests to the filter endpoint will attach your browser's timezone offset, so the server will automatically calculate timezone differences.\n\n    Matches can also be sorted with <b>sort</b> keys.\n    Their formats are: <code>sort:columnName[:d[escending]]</code>, where <code>:d[escending]</code> is an optional tag to set the direction to descending.\n    This key must be used with internal column names used in the database (<code>id</code>, <code>${all ? 'userid' : 'albumid'}</code>, and so on),\n    but there are 2 shortcuts available: <b>date</b> for <code>timestamp</code> column and <b>expiry</b> for <code>expirydate</code> column.\n    This key can also be specified more than once, where their order will decide the sorting steps.\n\n    Finally, there are type-<b>is</b> keys to refine by types.\n    You can use <code>is:image</code> and <code>is:video</code> to list images and videos respectively.\n    This will only use image/video extensions whose thumbnails can be generated by the safe.\n    Negation sign works for this key as well.\n    Mixing inclusion and exclusion is not allowed (i.e. <code>is:image -is:video</code>, since the second key is redundant).\n\n    Any leftover keywords which do not use keys (non-keyed keywords) will be matched against the matches' file names.\n    Excluding certain keywords is also supported by adding negation sign before the keywords.\n\n    <b>Internal steps:</b>\n    ${all ? `- Query uploads passing ALL exclusion filter keys OR matching ANY filter keys, if any.\n    - Refine matches` : '- Filter uploads'} using date key, if any.\n    - Refine matches using expiry key, if any.\n    - Refine matches using type-is keys, if any.\n    - Refine matches using ANY non-keyed keywords, if any.\n    - Filter matches using ALL exclusion non-keyed keywords, if any.\n    - Sort matches using sorting keys, if any.\n\n    <b>Examples:</b>\n    ${all ? `- Uploads from users named \"demo\" AND/OR \"John Doe\" AND/OR non-registered users:\n    <code>user:demo user:\"John Doe\" user:-</code>\n    - ALL uploads, but NOT the ones from user named \"demo\" AND \"John Doe\":\n    <code>-user:demo -user:\"John Doe\"</code>\n    - Uploads from IP \"127.0.0.1\" AND which file names match \"*.rar\" OR \"*.zip\":\n    <code>ip:127.0.0.1 *.rar *.zip</code>\n    ` : ''}- Uploads without albums:\n    <code>albumid:-</code>\n    - ALL uploads, but NOT the ones from album with ID 69:\n    <code>-albumid:69</code>\n    - Uploads uploaded since \"1 June 2019 00:00:00\":\n    <code>date:2019/06</code>\n    - Uploads uploaded between \"7 April 2020 12:00:00\" and \"7 April 2020 23:59:59\":\n    <code>date:2020/04/07 12-2020/04/07 23:59:59</code>\n    - Uploads uploaded before \"5 February 2020 00:00:00\":\n    <code>date:-2020/02/05</code>\n    - Uploads which file names match \"*.gz\" but NOT \"*.tar.gz\":\n    <code>*.gz -*.tar.gz</code>\n    - Sort matches by \"size\" column in ascending and descending order respectively:\n    <code>${all ? 'user:\"John Doe\"' : '*.txt'} sort:size</code>\n    <code>*.mp4 ${all ? 'user:- ' : ''}sort:size:d</code>\n    ${!page.permissions.moderator ? `\n    <b>Notice:</b> Regular users may face some limitations in the amount of keys that can be used at a time.\n    ` : ''}\n    <b>Friendly reminder:</b> This window can be scrolled up!\n  `.trim().replace(/^\\s*/g, '').replace(/\\n/g, '<br>')\n\n  swal({ content }).then(() => {\n    // Restore modal size\n    document.body.querySelector('.swal-overlay .swal-modal').classList.remove('is-expanded')\n  })\n\n  // Expand modal size\n  document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n}\n\npage.filterUploads = element => {\n  const filters = document.querySelector(`#${element.dataset.filtersid || 'filters'}`).value.trim()\n  // eslint-disable-next-line compat/compat\n  page.getUploads(Object.assign(page.views[page.currentView], {\n    filters,\n    pageNum: 0,\n    trigger: element\n  }))\n}\n\npage.viewUserUploads = (id, element) => {\n  const user = page.cache.users[id]\n  if (!user) return\n  element.classList.add('is-loading')\n  // Wrap username in quotes if it contains whitespaces\n  const username = user.username.includes(' ')\n    ? `\"${user.username}\"`\n    : user.username\n  page.getUploads({\n    all: true,\n    filters: `user:${username}`,\n    trigger: document.querySelector('#itemManageUploads')\n  })\n}\n\npage.deleteUpload = id => {\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: [id],\n    cb (failed) {\n      // Remove from remembered checkboxes if necessary\n      if (!failed.length && page.selected[page.currentView].includes(id))\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n\n      // Update local storage\n      if (page.selected[page.currentView].length)\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      else\n        delete localStorage[lsKeys.selected[page.currentView]]\n\n      // Reload upload list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign(page.views[page.currentView], {\n        autoPage: true\n      }))\n    }\n  })\n}\n\npage.bulkDeleteUploads = () => {\n  const count = page.selected[page.currentView].length\n  if (!count)\n    return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: page.selected[page.currentView],\n    cb (failed) {\n      // Update state of checkboxes\n      if (failed.length)\n        page.selected[page.currentView] = page.selected[page.currentView]\n          .filter(id => {\n            return failed.includes(id)\n          })\n      else\n        page.selected[page.currentView] = []\n\n      // Update local storage\n      if (page.selected[page.currentView].length)\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      else\n        delete localStorage[lsKeys.selected[page.currentView]]\n\n      // Reload uploads list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign(page.views[page.currentView], {\n        autoPage: true\n      }))\n    }\n  })\n}\n\npage.deleteUploadsByNames = (params = {}) => {\n  let appendix = ''\n  if (page.permissions.moderator)\n    appendix = '<br><b>Hint:</b> You can use this feature to delete uploads by other users.'\n\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">Upload names:</label>\n        <div class=\"control\">\n          <textarea id=\"bulkDeleteNames\" class=\"textarea\"></textarea>\n        </div>\n        <p class=\"help\">Separate each entry with a new line.${appendix}</p>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"submitBulkDelete\" class=\"button is-danger is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#submitBulkDelete').addEventListener('click', () => {\n    if (page.isSomethingLoading)\n      return page.warnSomethingLoading()\n\n    const textArea = document.querySelector('#bulkDeleteNames')\n\n    // Clean up\n    const seen = {}\n    const names = textArea.value\n      .split(/\\r?\\n/)\n      .map(name => {\n        const trimmed = name.trim()\n        return /^[^\\s]+$/.test(trimmed)\n          ? trimmed\n          : ''\n      })\n      .filter(name => {\n        // Filter out invalid and duplicate names\n        return (!name || Object.prototype.hasOwnProperty.call(seen, name))\n          ? false\n          : (seen[name] = true)\n      })\n\n    // Update textarea with cleaned names\n    textArea.value = names.join('\\n')\n\n    if (!names.length)\n      return swal('An error occurred!', 'You have not entered any upload names.', 'error')\n\n    page.postBulkDeleteUploads({\n      all: true,\n      field: 'name',\n      values: names,\n      cb (failed) {\n        textArea.value = failed.join('\\n')\n      }\n    })\n  })\n}\n\npage.postBulkDeleteUploads = (params = {}) => {\n  const count = params.values.length\n\n  const objective = `${params.values.length} upload${count === 1 ? '' : 's'}`\n  const boldObjective = objective.replace(/^(\\d*)(.*)/, '<b>$1</b>$2')\n  let text = `<p>You won't be able to recover ${boldObjective}!</p>`\n\n  if (params.all) {\n    const obj1 = count === 1 ? 'an upload' : 'some uploads'\n    const obj2 = count === 1 ? 'another user' : 'other users'\n    text += `\\n<p><b>Warning:</b> You may be nuking ${obj1} by ${obj2}!</p>`\n  }\n\n  const content = document.createElement('div')\n  content.innerHTML = text\n\n  swal({\n    title: 'Are you sure?',\n    content,\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: `Yes, nuke ${params.values.length === 1 ? 'it' : 'them'}!`,\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/upload/bulkdelete', {\n      field: params.fields,\n      values: params.values\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      const failed = Array.isArray(response.data.failed) ? response.data.failed : []\n      if (failed.length === params.values.length)\n        swal('An error occurred!', `Unable to delete any of the ${objective}.`, 'error')\n      else if (failed.length && failed.length < params.values.length)\n        swal('Warning!', `From ${objective}, unable to delete ${failed.length} of them.`, 'warning')\n      else\n        swal('Deleted!', `${objective} ${count === 1 ? 'has' : 'have'} been deleted.`, 'success', {\n          buttons: false,\n          timer: 1500\n        })\n\n      if (typeof params.cb === 'function')\n        params.cb(failed)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.addSelectedUploadsToAlbum = () => {\n  if (page.currentView !== 'uploads')\n    return\n\n  const count = page.selected[page.currentView].length\n  if (!count)\n    return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.addUploadsToAlbum(page.selected[page.currentView], failed => {\n    if (!failed) return\n    if (failed.length)\n      page.selected[page.currentView] = page.selected[page.currentView].filter(id => {\n        return failed.includes(id)\n      })\n    else\n      page.selected[page.currentView] = []\n\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addToAlbum = id => {\n  page.addUploadsToAlbum([id], failed => {\n    if (!failed) return\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addUploadsToAlbum = (ids, callback) => {\n  const count = ids.length\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <div class=\"field has-text-centered\">\n      <p>You are about to add <b>${count}</b> upload${count === 1 ? '' : 's'} to an album.</p>\n      <p><b>If an upload is already in an album, it will be moved.</b></p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalAlbum\" disabled>\n            <option value=\"-1\">Remove from album</option>\n            <option value=\"\" selected disabled>Fetching albums list\\u2026</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  `\n\n  swal({\n    icon: 'warning',\n    content,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'OK',\n        closeModal: false\n      }\n    }\n  }).then(choose => {\n    if (!choose) return\n\n    const albumid = parseInt(document.querySelector('#swalAlbum').value)\n    if (isNaN(albumid))\n      return swal('An error occurred!', 'You did not choose an album.', 'error')\n\n    axios.post('api/albums/addfiles', {\n      ids,\n      albumid\n    }).then(add => {\n      if (!add) return\n\n      if (add.data.success === false) {\n        if (add.data.description === 'No token provided')\n          page.verifyToken(page.token)\n        else\n          swal('An error occurred!', add.data.description, 'error')\n\n        return\n      }\n\n      let added = ids.length\n      if (add.data.failed && add.data.failed.length)\n        added -= add.data.failed.length\n\n      const suffix = `upload${ids.length === 1 ? '' : 's'}`\n      if (!added)\n        return swal('An error occurred!', `Could not add the ${suffix} to the album.`, 'error')\n\n      swal('Woohoo!', `Successfully ${albumid < 0 ? 'removed' : 'added'} ${added} ${suffix} ${albumid < 0 ? 'from' : 'to'} the album.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      callback(add.data.failed)\n    }).catch(page.onAxiosError)\n  })\n\n  // Get albums list then update content of swal\n  axios.get('api/albums').then(list => {\n    if (list.data.success === false) {\n      if (list.data.description === 'No token provided')\n        page.verifyToken(page.token)\n      else\n        swal('An error occurred!', list.data.description, 'error')\n\n      return\n    }\n\n    // If the prompt was replaced, the container would be missing\n    const select = document.querySelector('#swalAlbum')\n    if (!select) return\n\n    select.innerHTML += list.data.albums\n      .map(album => {\n        return `<option value=\"${album.id}\">${album.name}</option>`\n      })\n      .join('\\n')\n\n    select.getElementsByTagName('option')[1].innerHTML = 'Choose an album'\n    select.removeAttribute('disabled')\n  }).catch(page.onAxiosError)\n}\n\npage.getAlbums = (params = {}) => {\n  page.updateTrigger(params.trigger, 'loading')\n\n  axios.get('api/albums').then(response => {\n    if (!response) return\n\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    page.cache.albums = {}\n\n    page.dom.innerHTML = `\n      <h2 class=\"subtitle\">Create new album</h2>\n      <form class=\"prevent-default\">\n        <div class=\"field\">\n          <div class=\"control\">\n            <input id=\"albumName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\">\n          </div>\n          <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <textarea id=\"albumDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"1\" maxlength=\"${page.albumDescMaxLength}\"></textarea>\n          </div>\n          <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <button type=\"submit\" id=\"submitAlbum\" class=\"button is-info is-outlined is-fullwidth\" data-action=\"submit-album\">\n              <span class=\"icon\">\n                <i class=\"icon-paper-plane\"></i>\n              </span>\n              <span>Create</span>\n            </button>\n          </div>\n        </div>\n      </form>\n      <hr>\n      <h2 class=\"subtitle\">List of albums</h2>\n      <div class=\"table-container\">\n        <table class=\"table is-narrow is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th>ID</th>\n              <th>Name</th>\n              <th>Files</th>\n              <th>Created at</th>\n              <th>Public link</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n    `\n\n    const homeDomain = response.data.homeDomain\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < response.data.albums.length; i++) {\n      const album = response.data.albums[i]\n      const albumUrl = `${homeDomain}/a/${album.identifier}`\n\n      // Prettify\n      album.prettyDate = page.getPrettyDate(new Date(album.timestamp * 1000))\n\n      page.cache.albums[album.id] = {\n        name: album.name,\n        download: album.download,\n        public: album.public,\n        description: album.description\n      }\n\n      const tr = document.createElement('tr')\n      tr.innerHTML = `\n        <th>${album.id}</th>\n        <th>${album.name}</th>\n        <th>${album.files}</th>\n        <td>${album.prettyDate}</td>\n        <td><a ${album.public ? `href=\"${albumUrl}\"` : 'class=\"is-linethrough\"'} target=\"_blank\">${albumUrl}</a></td>\n        <td class=\"has-text-right\" data-id=\"${album.id}\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit album\" data-action=\"edit-album\">\n            <span class=\"icon is-small\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" ${album.public ? `data-clipboard-text=\"${albumUrl}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-clipboard\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"Download album\" ${album.download ? `href=\"api/album/zip/${album.identifier}?v=${album.editedAt}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-download\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Delete album\" data-action=\"delete-album\">\n            <span class=\"icon is-small\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n    }\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.editAlbum = id => {\n  const album = page.cache.albums[id]\n  if (!album) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <div class=\"controls\">\n        <input id=\"swalName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\" value=\"${(album.name || '').substring(0, page.albumTitleMaxLength)}\">\n      </div>\n      <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <textarea id=\"swalDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"2\" maxlength=\"${page.albumDescMaxLength}\">${(album.description || '').substring(0, page.albumDescMaxLength)}</textarea>\n      </div>\n      <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalDownload\" type=\"checkbox\" ${album.download ? 'checked' : ''}>\n          Enable download\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalPublic\" type=\"checkbox\" ${album.public ? 'checked' : ''}>\n          Enable public link\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalRequestLink\" type=\"checkbox\">\n          Request new public link\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Edit album',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(value => {\n    if (!value) return\n\n    axios.post('api/albums/edit', {\n      id,\n      name: document.querySelector('#swalName').value.trim(),\n      description: document.querySelector('#swalDescription').value.trim(),\n      download: document.querySelector('#swalDownload').checked,\n      public: document.querySelector('#swalPublic').checked,\n      requestLink: document.querySelector('#swalRequestLink').checked\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      if (response.data.identifier)\n        swal('Success!', `Your album's new identifier is: ${response.data.identifier}.`, 'success')\n      else if (response.data.name !== album.name)\n        swal('Success!', `Your album was renamed to: ${response.data.name}.`, 'success')\n      else\n        swal('Success!', 'Your album was edited!', 'success', {\n          buttons: false,\n          timer: 1500\n        })\n\n      page.getAlbumsSidebar()\n      page.getAlbums()\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.deleteAlbum = id => {\n  swal({\n    title: 'Are you sure?',\n    text: 'This won\\'t delete your uploads, only the album!',\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, delete it!',\n        closeModal: false\n      },\n      purge: {\n        text: 'Umm, delete the uploads too please?',\n        value: 'purge',\n        className: 'swal-button--danger',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/albums/delete', {\n      id,\n      purge: proceed === 'purge'\n    }).then(response => {\n      if (response.data.success === false) {\n        const failed = Array.isArray(response.data.failed)\n          ? response.data.failed\n          : []\n\n        if (response.data.description === 'No token provided')\n          return page.verifyToken(page.token)\n        else if (failed.length)\n          return swal('An error occurred!', `Unable to delete ${failed.length} of the album's upload${failed.length === 1 ? '' : 's'}.`, 'error')\n        else\n          return swal('An error occurred!', response.data.description, 'error')\n      }\n\n      swal('Deleted!', 'Your album has been deleted.', 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      page.getAlbumsSidebar()\n      page.getAlbums()\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.submitAlbum = element => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/albums', {\n    name: document.querySelector('#albumName').value.trim(),\n    description: document.querySelector('#albumDescription').value.trim()\n  }).then(response => {\n    if (!response) return\n\n    page.updateTrigger(element)\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    swal('Woohoo!', 'Album was created successfully.', 'success', {\n      buttons: false,\n      timer: 1500\n    })\n    page.getAlbumsSidebar()\n    page.getAlbums()\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getAlbumsSidebar = () => {\n  axios.get('api/albums/sidebar').then(response => {\n    if (!response) return\n\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const albumsContainer = document.querySelector('#albumsContainer')\n\n    // Clear albums sidebar if necessary\n    const oldAlbums = albumsContainer.querySelectorAll('li > a')\n    if (oldAlbums.length) {\n      for (let i = 0; i < oldAlbums.length; i++)\n        page.menus.splice(page.menus.indexOf(oldAlbums[i]), 1)\n      albumsContainer.innerHTML = ''\n    }\n\n    if (response.data.albums === undefined)\n      return\n\n    for (let i = 0; i < response.data.albums.length; i++) {\n      const album = response.data.albums[i]\n      const li = document.createElement('li')\n      const a = document.createElement('a')\n      a.id = album.id\n      a.innerHTML = album.name\n      a.className = 'is-relative'\n\n      a.addEventListener('click', event => {\n        page.getUploads({\n          album: parseInt(event.currentTarget.id),\n          trigger: event.currentTarget\n        })\n      })\n      page.menus.push(a)\n\n      li.appendChild(a)\n      albumsContainer.appendChild(li)\n    }\n  }).catch(page.onAxiosError)\n}\n\npage.changeToken = (params = {}) => {\n  page.dom.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Your current token:</label>\n      <div class=\"field\">\n        <div class=\"control\">\n          <input id=\"token\" readonly class=\"input\" type=\"text\" placeholder=\"Your token\" value=\"${page.token}\">\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <a id=\"getNewToken\" class=\"button is-info is-outlined is-fullwidth\">\n          <span class=\"icon\">\n            <i class=\"icon-arrows-cw\"></i>\n          </span>\n          <span>Request new token</span>\n        </a>\n      </div>\n    </div>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#getNewToken').addEventListener('click', event => {\n    if (page.isSomethingLoading)\n      return page.warnSomethingLoading()\n\n    const trigger = event.currentTarget\n    page.updateTrigger(trigger, 'loading')\n    axios.post('api/tokens/change').then(response => {\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          page.updateTrigger(trigger)\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      page.updateTrigger(trigger)\n      swal({\n        title: 'Woohoo!',\n        text: 'Your token was successfully changed.',\n        icon: 'success',\n        buttons: false,\n        timer: 1500\n      }).then(() => {\n        axios.defaults.headers.common.token = response.data.token\n        localStorage[lsKeys.token] = response.data.token\n        page.token = response.data.token\n        page.changeToken()\n      })\n    }).catch(error => {\n      page.updateTrigger(trigger)\n      page.onAxiosError(error)\n    })\n  })\n}\n\npage.changePassword = (params = {}) => {\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">New password:</label>\n        <div class=\"control\">\n          <input id=\"password\" class=\"input\" type=\"password\" minlength=\"6\" maxlength=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <label class=\"label\">Re-type new password:</label>\n        <div class=\"control\">\n          <input id=\"passwordConfirm\" class=\"input\" type=\"password\" minlength=\"6\" maxlength=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"sendChangePassword\" class=\"button is-info is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-paper-plane\"></i>\n            </span>\n            <span>Set new password</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#sendChangePassword').addEventListener('click', event => {\n    if (page.isSomethingLoading)\n      return page.warnSomethingLoading()\n\n    if (!page.dom.querySelector('form').checkValidity())\n      return\n\n    if (document.querySelector('#password').value === document.querySelector('#passwordConfirm').value)\n      page.sendNewPassword(document.querySelector('#password').value, event.currentTarget)\n    else\n      swal({\n        title: 'Password mismatch!',\n        text: 'Your passwords do not match, please try again.',\n        icon: 'error'\n      })\n  })\n}\n\npage.sendNewPassword = (pass, element) => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/password/change', { password: pass }).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(element)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    page.updateTrigger(element)\n    swal({\n      title: 'Woohoo!',\n      text: 'Your password was successfully changed.',\n      icon: 'success',\n      buttons: false,\n      timer: 1500\n    }).then(() => {\n      page.changePassword()\n    })\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getUsers = (params = {}) => {\n  if (page.isSomethingLoading)\n    return page.warnSomethingLoading()\n\n  if (!page.permissions.admin)\n    return swal('An error occurred!', 'You cannot do this!', 'error')\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (params.pageNum === undefined)\n    params.pageNum = 0\n\n  const url = `api/users/${params.pageNum}`\n  axios.get(url).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const pages = Math.ceil(response.data.count / 25)\n    if (params.pageNum && (response.data.users.length === 0))\n      if (params.autoPage) {\n        params.pageNum = pages - 1\n        return page.getUsers(params)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', `There are no more users to populate page ${params.pageNum + 1}.`, 'error')\n      }\n\n    page.currentView = 'users'\n    page.cache.users = {}\n\n    if (params.pageNum < 0) params.pageNum = Math.max(0, pages + params.pageNum)\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    const filter = `\n      <div class=\"column\">\n        <form class=\"prevent-default\">\n          <div class=\"field has-addons\">\n            <div class=\"control is-expanded\">\n              <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filters (WIP)\" value=\"${page.escape(params.filters || '')}\" disabled>\n            </div>\n            <div class=\"control\">\n              <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help? (WIP)\" data-action=\"user-filters-help\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-help-circled\"></i>\n                </span>\n              </button>\n            </div>\n            <div class=\"control\">\n              <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter users (WIP)\" data-action=\"filter-users\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-filter\"></i>\n                </span>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" min=\"1\" max=\"${pages}\" value=\"${params.pageNum + 1}\"${pages === 1 ? ' disabled' : ''}>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column exclusive-operations has-text-left\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Create new user\" data-action=\"create-user\">\n            <span class=\"icon\">\n              <i class=\"icon-plus\"></i>\n            </span>\n            <span>Create new user</span>\n          </a>\n        </div>\n        <div class=\"column bulk-operations has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"Bulk disable (WIP)\" data-action=\"bulk-disable-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete (WIP)\" data-action=\"bulk-delete-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Do some string replacements for bottom controls\n    const bottomFiltersId = 'bFilters'\n    const bottomJumpId = 'bJumpToPage'\n    const bottomExtraControls = extraControls\n      .replace(/id=\"filters\"/, `id=\"${bottomFiltersId}\"`)\n      .replace(/(data-action=\"filter-uploads\")/, `$1 data-filtersid=\"${bottomFiltersId}\"`)\n      .replace(/id=\"jumpToPage\"/, `id=\"${bottomJumpId}\"`)\n      .replace(/(data-action=\"jump-to-page\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n    const bottomPagination = pagination\n      .replace(/(data-action=\"page-ellipsis\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    page.dom.innerHTML = `\n      ${pagination}\n      ${extraControls}\n      ${controls}\n      <div class=\"table-container\">\n        <table class=\"table is-narrow is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n              <th title=\"Key: username\">Username</th>\n              <th>Uploads</th>\n              <th>Usage</th>\n              <th title=\"Key: permission\">Group</th>\n              <th title=\"Key: registration\">Registration date</th>\n              <th title=\"Key: timestamp\">Last token update</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n      ${controls}\n      ${bottomExtraControls}\n      ${bottomPagination}\n    `\n\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < response.data.users.length; i++) {\n      const user = response.data.users[i]\n      const selected = page.selected.users.includes(user.id)\n      if (!selected) unselected = true\n\n      let displayGroup = null\n      const groups = Object.keys(user.groups)\n      for (let i = 0; i < groups.length; i++) {\n        if (!user.groups[groups[i]]) break\n        displayGroup = groups[i]\n      }\n\n      // Server-side explicitly expects either of these two values to consider a user as disabled\n      const enabled = user.enabled !== false && user.enabled !== 0\n      page.cache.users[user.id] = {\n        username: user.username,\n        groups: user.groups,\n        enabled,\n        displayGroup\n      }\n\n      const prettyDate = user.registration\n        ? page.getPrettyDate(new Date(user.registration * 1000))\n        : '-'\n      const prettyTokenUpdate = user.timestamp\n        ? page.getPrettyDate(new Date(user.timestamp * 1000))\n        : '-'\n\n      const tr = document.createElement('tr')\n      tr.dataset.id = user.id\n      tr.innerHTML = `\n        <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${selected ? ' checked' : ''}></td>\n        <th${enabled ? '' : ' class=\"is-linethrough\"'}>${user.username}</td>\n        <th>${user.uploads}</th>\n        <td>${page.getPrettyBytes(user.usage)}</td>\n        <td>${displayGroup}</td>\n        <td>${prettyDate}</td>\n        <td>${prettyTokenUpdate}</td>\n        <td class=\"controls has-text-right\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit user\" data-action=\"edit-user\">\n            <span class=\"icon\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined\" title=\"${user.uploads ? 'View uploads' : 'User doesn\\'t have uploads'}\" data-action=\"view-user-uploads\" ${user.uploads ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-docs\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"${enabled ? 'Disable user' : 'User is disabled'}\" data-action=\"disable-user\" ${enabled ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Delete user\" data-action=\"delete-user\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n      page.checkboxes.users = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n\n    page.views.users.pageNum = response.data.users.length ? params.pageNum : 0\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.createUser = () => {\n  const groupOptions = Object.keys(page.permissions).map((g, i, a) => {\n    const disabled = !(a[i + 1] && page.permissions[a[i + 1]])\n    return `<option value=\"${g}\"${disabled ? ' disabled' : ''}>${g}</option>`\n  }).join('\\n')\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Username</label>\n      <div class=\"controls\">\n        <input id=\"swalUsername\" class=\"input\" type=\"text\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">Password (optional)</label>\n      <div class=\"controls\">\n        <input id=\"swalPassword\" class=\"input\" type=\"text\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">User group</label>\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalGroup\">\n            ${groupOptions}\n          </select>\n        </div>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Create new user',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/create', {\n      username: document.querySelector('#swalUsername').value,\n      password: document.querySelector('#swalPassword').value,\n      group: document.querySelector('#swalGroup').value\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      const div = document.createElement('div')\n      div.innerHTML = `\n        <p>Username: <b>${response.data.username}</b></p>\n        <p>Password: <code>${response.data.password}</code></p>\n        <p>User group: <b>${response.data.group}</b></p>\n      `\n      swal({\n        title: 'Created a new user!',\n        icon: 'success',\n        content: div\n      })\n\n      // Load last page of users list\n      // eslint-disable-next-line compat/compat\n      page.getUsers(Object.assign(page.views.users, {\n        pageNum: -1\n      }))\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.editUser = id => {\n  const user = page.cache.users[id]\n  if (!user) return\n\n  const groupOptions = Object.keys(page.permissions).map((g, i, a) => {\n    const selected = g === user.displayGroup\n    const disabled = !(a[i + 1] && page.permissions[a[i + 1]])\n    return `<option value=\"${g}\"${selected ? ' selected' : ''}${disabled ? ' disabled' : ''}>${g}</option>`\n  }).join('\\n')\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <p>User ID: ${id}</p>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">Username</label>\n      <div class=\"controls\">\n        <input id=\"swalUsername\" class=\"input\" type=\"text\" value=\"${user.username || ''}\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">User group</label>\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalGroup\">\n            ${groupOptions}\n          </select>\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalEnabled\" type=\"checkbox\" ${user.enabled ? 'checked' : ''}>\n          Enabled\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalResetPassword\" type=\"checkbox\">\n          Reset password\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Edit user',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/edit', {\n      id,\n      username: document.querySelector('#swalUsername').value,\n      group: document.querySelector('#swalGroup').value,\n      enabled: document.querySelector('#swalEnabled').checked,\n      resetPassword: document.querySelector('#swalResetPassword').checked\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      let autoClose = true\n      const div = document.createElement('div')\n\n      let displayName = user.username\n      if (response.data.update.username !== user.username) {\n        div.innerHTML += `<p>${user.username} was renamed into: <b>${response.data.update.username}</b>.</p>`\n        autoClose = false\n        displayName = response.data.update.username\n      }\n\n      if (response.data.update.password) {\n        div.innerHTML += `\n          <p>${displayName}'s new password is:</p>\n          <p><code>${response.data.update.password}</code></p>\n        `\n        autoClose = false\n      }\n\n      if (response.data.update.enabled !== user.enabled)\n        div.innerHTML += `<p>${displayName} has been ${response.data.update.enabled ? 'enabled' : 'disabled'}!</p>`\n\n      if (!div.innerHTML)\n        div.innerHTML = `<p>${displayName} was edited!</p>`\n\n      swal({\n        title: 'Success!',\n        icon: 'success',\n        content: div,\n        buttons: !autoClose,\n        timer: autoClose ? 1500 : null\n      })\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.disableUser = id => {\n  const user = page.cache.users[id]\n  if (!user || !user.enabled) return\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p>You will be disabling a user named <b>${page.cache.users[id].username}</b>.</p>\n    <p>Their files will remain.</p>\n  `\n\n  swal({\n    title: 'Are you sure?',\n    icon: 'warning',\n    content,\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, disable them!',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/disable', { id }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided')\n          return page.verifyToken(page.token)\n        else\n          return swal('An error occurred!', response.data.description, 'error')\n\n      swal('Success!', `${page.cache.users[id].username} has been disabled.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.deleteUser = id => {\n  const user = page.cache.users[id]\n  if (!user) return\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p>You will be deleting a user named <b>${page.cache.users[id].username}</b>.<p>\n    <p>Their files will remain, unless you choose otherwise.</p>\n  `\n\n  swal({\n    title: 'Are you sure?',\n    icon: 'warning',\n    content,\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, delete it!',\n        closeModal: false\n      },\n      purge: {\n        text: 'Yes, and the uploads too!',\n        value: 'purge',\n        className: 'swal-button--danger',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/delete', {\n      id,\n      purge: proceed === 'purge'\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        const failed = Array.isArray(response.data.failed)\n          ? response.data.failed\n          : []\n\n        if (response.data.description === 'No token provided')\n          return page.verifyToken(page.token)\n        else if (failed.length)\n          return swal('An error occurred!', `Unable to delete ${failed.length} of the user's upload${failed.length === 1 ? '' : 's'}.`, 'error')\n        else\n          return swal('An error occurred!', response.data.description, 'error')\n      }\n\n      swal('Success!', `${page.cache.users[id].username} has been deleted.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n\n      // Reload users list\n      // eslint-disable-next-line compat/compat\n      page.getUsers(Object.assign(page.views.users, {\n        autoPage: true\n      }))\n    }).catch(page.onAxiosError)\n  })\n}\n\n// Roughly based on https://github.com/mayuska/pagination/blob/master/index.js\npage.paginate = (totalItems, itemsPerPage, currentPage) => {\n  currentPage = currentPage + 1\n  const step = 3\n  const numPages = Math.ceil(totalItems / itemsPerPage)\n\n  let template = ''\n  const elementsToShow = step * 2\n  const add = {\n    pageNum (start, end) {\n      for (let i = start; i <= end; ++i)\n        template += `<li><a class=\"button pagination-link ${i === currentPage ? ' is-current' : ''}\" aria-label=\"Goto page ${i}\" data-action=\"page-goto\" data-goto=\"${i - 1}\">${i}</a></li>`\n    },\n    startDots () {\n      template += `\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page 1\" data-action=\"page-goto\" data-goto=\"0\">1</a></li>\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n      `\n    },\n    endDots () {\n      template += `\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page ${numPages}\" data-action=\"page-goto\" data-goto=\"${numPages - 1}\">${numPages}</a></li>\n      `\n    }\n  }\n\n  if (elementsToShow + 1 >= numPages) {\n    add.pageNum(1, numPages)\n  } else if (currentPage < elementsToShow) {\n    add.pageNum(1, elementsToShow)\n    add.endDots()\n  } else if (currentPage > numPages - elementsToShow + 1) {\n    add.startDots()\n    add.pageNum(numPages - elementsToShow + 1, numPages)\n  } else {\n    add.startDots()\n    add.pageNum(currentPage - step + 1, currentPage + step - 1)\n    add.endDots()\n  }\n\n  return `\n    <nav class=\"pagination is-centered is-small\">\n      <a class=\"button pagination-previous\" data-action=\"page-prev\"${currentPage === 1 ? ' disabled' : ''}>Previous</a>\n      <a class=\"button pagination-next\" data-action=\"page-next\"${currentPage >= numPages ? ' disabled' : ''}>Next page</a>\n      <ul class=\"pagination-list\">${template}</ul>\n    </nav>\n  `\n}\n\npage.getStatistics = (params = {}) => {\n  if (!page.permissions.admin)\n    return swal('An error occurred!', 'You cannot do this!', 'error')\n\n  if (page.isSomethingLoading)\n    return page.warnSomethingLoading()\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  const url = 'api/stats'\n  axios.get(url).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    let content = ''\n    const keys = Object.keys(response.data.stats)\n    for (let i = 0; i < keys.length; i++) {\n      let rows = ''\n      if (!response.data.stats[keys[i]])\n        rows += `\n          <tr>\n            <td>Generating, please try again later\\u2026</td>\n            <td></td>\n          </tr>\n        `\n      else\n        try {\n          const types = response.data.stats[keys[i]]._types || {}\n          const valKeys = Object.keys(response.data.stats[keys[i]])\n          for (let j = 0; j < valKeys.length; j++) {\n            // Skip keys that starts with an underscore\n            if (/^_/.test(valKeys[j]))\n              continue\n\n            const value = response.data.stats[keys[i]][valKeys[j]]\n            let parsed = value\n\n            // Parse values with some preset formatting\n            if ((types.number || []).includes(valKeys[j]))\n              parsed = value.toLocaleString()\n            if ((types.byte || []).includes(valKeys[j]))\n              parsed = page.getPrettyBytes(value)\n            if ((types.byteUsage || []).includes(valKeys[j]))\n              parsed = `${page.getPrettyBytes(value.used)} / ${page.getPrettyBytes(value.total)} (${Math.round(value.used / value.total * 100)}%)`\n\n            const string = valKeys[j]\n              .replace(/([A-Z])/g, ' $1')\n              .replace(/(^|\\s)(cpu|db|zip)/gi, s => s.toUpperCase())\n            rows += `\n              <tr>\n                <th class=\"capitalize\">${string}</th>\n                <td>${parsed}</td>\n              </tr>\n            `\n          }\n        } catch (error) {\n          rows = `\n              <tr>\n                <td>Error parsing response. Try again?</td>\n                <td></td>\n              </tr>\n            `\n          page.onError(error)\n        }\n\n      content += `\n        <div class=\"table-container\">\n          <table id=\"statistics\" class=\"table is-narrow is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th class=\"capitalize\">${keys[i]}</th>\n                <td></td>\n              </tr>\n            </thead>\n            <tbody>\n              ${rows}\n            </tbody>\n          </table>\n        </div>\n      `\n    }\n\n    page.dom.innerHTML = content\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\nwindow.onload = () => {\n  // Polyfill Object.assign()\n  // eslint-disable-next-line compat/compat\n  if (typeof Object.assign !== 'function')\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, 'assign', {\n      value: function assign (target, varArgs) { // .length of function is 2\n        'use strict'\n        if (target === null || target === undefined)\n          throw new TypeError('Cannot convert undefined or null to object')\n        const to = Object(target)\n        for (let i = 1; i < arguments.length; i++) {\n          const nextSource = arguments[i]\n          if (nextSource !== null && nextSource !== undefined)\n            for (const nextKey in nextSource)\n              // Avoid bugs when hasOwnProperty is shadowed\n              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey))\n                to[nextKey] = nextSource[nextKey]\n        }\n        return to\n      },\n      writable: true,\n      configurable: true\n    })\n\n  // Add 'no-touch' class to non-touch devices\n  if (!('ontouchstart' in document.documentElement))\n    document.documentElement.classList.add('no-touch')\n\n  const selectedKeys = ['uploads', 'uploadsAll', 'users']\n  for (let i = 0; i < selectedKeys.length; i++) {\n    const ls = localStorage[lsKeys.selected[selectedKeys[i]]]\n    if (ls) page.selected[selectedKeys[i]] = JSON.parse(ls)\n  }\n\n  page.preparePage()\n\n  page.clipboardJS = new ClipboardJS('.clipboard-js')\n\n  page.clipboardJS.on('success', () => {\n    return swal('', 'The link has been copied to clipboard.', 'success', {\n      buttons: false,\n      timer: 1500\n    })\n  })\n\n  page.clipboardJS.on('error', page.onError)\n\n  page.lazyLoad = new LazyLoad()\n}\n"]}