{"version":3,"sources":["dashboard.js"],"names":["const","lsKeys","token","viewType","uploads","uploadsAll","selected","users","page","dom","localStorage","username","permissions","menusContainer","menus","currentView","views","type","album","pageNum","filters","all","checkboxes","lastSelected","upload","user","selectAlbumContainer","cache","albums","clipboardJS","lazyLoad","imageExts","videoExts","isTriggerLoading","fadingIn","albumTitleMaxLength","albumDescMaxLength","unhide","document","querySelector","classList","add","remove","onError","error","console","content","createElement","innerHTML","toString","swal","title","icon","onAxiosError","statusText","520","521","522","523","524","525","526","527","530","response","status","description","data","preparePage","verifyToken","window","location","reloadOnError","axios","post","then","success","text","removeItem","defaults","headers","common","prepareDashboard","catch","addEventListener","domClick","event","target","contains","preventDefault","itemMenus","selector","onclick","getUploads","deleteUploadsByNames","getAlbums","changeToken","changePassword","logout","params","group","getStatistics","getUsers","loop","i","item","call","Object","assign","trigger","currentTarget","push","length","moderator","getAlbumsSidebar","prepareShareX","updateTrigger","newState","parentNode","tagName","let","getItemID","element","parent","parseInt","dataset","id","includes","action","hasAttribute","stopPropagation","setUploadsView","clearSelection","addSelectedUploadsToAlbum","select","selectAll","addToAlbum","deleteUpload","bulkDeleteUploads","displayPreview","submitAlbum","editAlbum","deleteAlbum","getNewToken","createUser","editUser","disableUser","deleteUser","userFiltersHelp","filterUploads","viewUserUploads","focusJumpToPage","switchPage","fadeAndScroll","disableFading","clearTimeout","setTimeout","scrollIntoView","behavior","block","inline","func","goto","jumpToPage","checkValidity","parsed","value","isNaN","focus","undefined","url","get","pages","Math","ceil","count","files","autoPage","basedomain","pagination","paginate","filter","extraControls","controls","unselected","hasExpiryDateColumn","some","file","expirydate","thumb","exec","extname","toLowerCase","name","original","prettyBytes","getPrettyBytes","size","prettyDate","getPrettyDate","Date","timestamp","prettyExpiryDate","appendix","userid","albumid","table","div","className","appendChild","querySelectorAll","tr","ip","checked","update","view","isimage","isvideo","src","onload","body","onerror","video","autoplay","insertAdjacentElement","buttons","splice","indexOf","JSON","stringify","selectInBetween","lastElement","thisIndex","index","lastIndex","abs","shiftKey","suffix","substring","proceed","style","trim","replace","postBulkDeleteUploads","field","values","cb","failed","textArea","seen","names","split","map","trimmed","test","prototype","hasOwnProperty","join","objective","dangerMode","cancel","confirm","closeModal","fields","Array","isArray","timer","addUploadsToAlbum","ids","callback","choose","added","list","getElementsByTagName","removeAttribute","homeDomain","albumUrl","download","public","requestLink","identifier","purge","albumsContainer","oldAlbums","li","a","sendNewPassword","pass","password","admin","displayGroup","groups","keys","enabled","usage","groupOptions","g","resetPassword","totalItems","itemsPerPage","currentPage","numPages","template","start","end","elementsToShow","step","stats","rows","types","_types","valKeys","j","number","toLocaleString","byte","byteUsage","used","total","round","toUpperCase","defineProperty","varArgs","arguments$1","arguments","TypeError","to","nextSource","nextKey","writable","configurable","documentElement","selectedKeys","ls","parse","ClipboardJS","on","LazyLoad"],"mappings":"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","file":"dashboard.js","sourcesContent":["/* global swal, axios, ClipboardJS, LazyLoad */\n\nconst lsKeys = {\n  token: 'token',\n  viewType: {\n    uploads: 'viewTypeUploads',\n    uploadsAll: 'viewTypeUploadsAll'\n  },\n  selected: {\n    uploads: 'selectedUploads',\n    uploadsAll: 'selectedUploadsAll',\n    users: 'selectedUsers'\n  }\n}\n\nconst page = {\n  // #page\n  dom: null,\n\n  // user token\n  token: localStorage[lsKeys.token],\n\n  // from api/tokens/verify\n  username: null,\n  permissions: null,\n\n  // sidebar menus\n  menusContainer: null,\n  menus: [],\n\n  currentView: null,\n  views: {\n    // config of uploads view\n    uploads: {\n      type: localStorage[lsKeys.viewType.uploads],\n      album: null, // album's id\n      pageNum: null // page num\n    },\n    // config of uploads view (all)\n    uploadsAll: {\n      type: localStorage[lsKeys.viewType.uploadsAll],\n      filters: null, // uploads' filters\n      pageNum: null, // page num\n      all: true\n    },\n    // config of users view\n    users: {\n      filters: null, // users' filters\n      pageNum: null\n    }\n  },\n\n  // id of selected items (shared across pages and will be synced with localStorage)\n  selected: {\n    uploads: [],\n    uploadsAll: [],\n    users: []\n  },\n  checkboxes: {\n    uploads: [],\n    uploadsAll: [],\n    users: []\n  },\n  lastSelected: {\n    upload: null,\n    uploadsAll: null,\n    user: null\n  },\n\n  // select album dom for dialogs/modals\n  selectAlbumContainer: null,\n\n  // cache for dialogs/modals\n  cache: {\n    uploads: {},\n    albums: {},\n    users: {}\n  },\n\n  clipboardJS: null,\n  lazyLoad: null,\n\n  imageExts: ['.webp', '.jpg', '.jpeg', '.gif', '.png', '.tiff', '.tif', '.svg'],\n  // some of these extensions can not be played directly in browsers\n  videoExts: ['.webm', '.mp4', '.wmv', '.avi', '.mov', '.mkv'],\n\n  isTriggerLoading: null,\n  fadingIn: null,\n\n  albumTitleMaxLength: 70,\n  albumDescMaxLength: 4000\n}\n\npage.unhide = () => {\n  document.querySelector('#loader').classList.add('is-hidden')\n  document.querySelector('#dashboard').classList.remove('is-hidden')\n}\n\n// Handler for regular JS errors\npage.onError = error => {\n  console.error(error)\n\n  const content = document.createElement('div')\n  content.innerHTML = `<code>${error.toString()}</code>`\n  return swal({\n    title: 'An error occurred!',\n    icon: 'error',\n    content\n  })\n}\n\n// Handler for Axios errors\npage.onAxiosError = error => {\n  console.error(error)\n\n  // Better Cloudflare errors\n  const cloudflareErrors = {\n    520: 'Unknown Error',\n    521: 'Web Server Is Down',\n    522: 'Connection Timed Out',\n    523: 'Origin Is Unreachable',\n    524: 'A Timeout Occurred',\n    525: 'SSL Handshake Failed',\n    526: 'Invalid SSL Certificate',\n    527: 'Railgun Error',\n    530: 'Origin DNS Error'\n  }\n\n  const statusText = cloudflareErrors[error.response.status] || error.response.statusText\n  const description = error.response.data && error.response.data.description\n    ? error.response.data.description\n    : 'There was an error with the request, please check the console for more information.'\n\n  return swal(`${error.response.status} ${statusText}`, description, 'error')\n}\n\npage.preparePage = () => {\n  if (page.token)\n    page.verifyToken(page.token, true)\n  else\n    window.location = 'auth'\n}\n\npage.verifyToken = (token, reloadOnError) => {\n  axios.post('api/tokens/verify', { token }).then(response => {\n    if (response.data.success === false)\n      return swal({\n        title: 'An error occurred!',\n        text: response.data.description,\n        icon: 'error'\n      }).then(() => {\n        if (!reloadOnError) return\n        localStorage.removeItem(lsKeys.token)\n        window.location = 'auth'\n      })\n\n    axios.defaults.headers.common.token = token\n    localStorage[lsKeys.token] = token\n\n    page.token = token\n    page.username = response.data.username\n    page.permissions = response.data.permissions\n    page.prepareDashboard()\n  }).catch(page.onAxiosError)\n}\n\npage.prepareDashboard = () => {\n  page.dom = document.querySelector('#page')\n\n  // Capture all click events\n  page.dom.addEventListener('click', page.domClick, true)\n\n  // Capture all submit events\n  page.dom.addEventListener('submit', event => {\n    // Prevent default if necessary\n    if (event.target && event.target.classList.contains('prevent-default'))\n      return event.preventDefault()\n  }, true)\n\n  page.menusContainer = document.querySelector('#menu')\n\n  // All item menus in the sidebar\n  const itemMenus = [\n    { selector: '#itemUploads', onclick: page.getUploads },\n    { selector: '#itemDeleteUploadsByNames', onclick: page.deleteUploadsByNames },\n    { selector: '#itemManageAlbums', onclick: page.getAlbums },\n    { selector: '#itemManageToken', onclick: page.changeToken },\n    { selector: '#itemChangePassword', onclick: page.changePassword },\n    { selector: '#itemLogout', onclick: page.logout },\n    { selector: '#itemManageUploads', onclick: page.getUploads, params: { all: true }, group: 'moderator' },\n    { selector: '#itemStatistics', onclick: page.getStatistics, group: 'admin' },\n    { selector: '#itemManageUsers', onclick: page.getUsers, group: 'admin' }\n  ]\n\n  for (let i = 0; i < itemMenus.length; i++) {\n    // Skip item menu if not enough permission\n    if (itemMenus[i].group && !page.permissions[itemMenus[i].group])\n      continue\n\n    // Add onclick event listener\n    const item = document.querySelector(itemMenus[i].selector)\n    item.addEventListener('click', event => {\n      // This class name isn't actually being applied fast enough\n      if (page.menusContainer.classList.contains('is-loading'))\n        return\n\n      // eslint-disable-next-line compat/compat\n      itemMenus[i].onclick.call(null, Object.assign({\n        trigger: event.currentTarget\n      }, itemMenus[i].params || {}))\n    })\n\n    item.classList.remove('is-hidden')\n    page.menus.push(item)\n  }\n\n  // If at least a moderator, show administration section\n  if (page.permissions.moderator) {\n    document.querySelector('#itemLabelAdmin').classList.remove('is-hidden')\n    document.querySelector('#itemListAdmin').classList.remove('is-hidden')\n  }\n\n  // Update text of logout button\n  document.querySelector('#itemLogout').innerHTML = `Logout ( ${page.username} )`\n\n  // Finally display dashboard\n  page.unhide()\n\n  // Load albums sidebar\n  page.getAlbumsSidebar()\n\n  if (typeof page.prepareShareX === 'function')\n    page.prepareShareX()\n}\n\npage.logout = params => {\n  page.updateTrigger(params.trigger, 'active')\n  localStorage.removeItem(lsKeys.token)\n  window.location = 'auth'\n}\n\npage.updateTrigger = (trigger, newState) => {\n  if (!trigger) return\n\n  // Disable menus container when loading\n  if (newState === 'loading')\n    page.menusContainer.classList.add('is-loading')\n  else\n    page.menusContainer.classList.remove('is-loading')\n\n  if (newState === 'loading') {\n    trigger.classList.add('is-loading')\n  } else if (newState === 'active') {\n    if (trigger.parentNode.tagName !== 'LI')\n      return\n    for (let i = 0; i < page.menus.length; i++)\n      page.menus[i].classList.remove('is-active')\n    trigger.classList.remove('is-loading')\n    trigger.classList.add('is-active')\n  } else {\n    trigger.classList.remove('is-loading')\n    trigger.classList.remove('is-active')\n  }\n}\n\npage.getItemID = element => {\n  // This expects the item's parent to have the item's ID\n  let parent = element.parentNode\n  // If the element is part of a set of controls, use the container's parent instead\n  if (element.parentNode.classList.contains('controls')) parent = parent.parentNode\n  return parseInt(parent.dataset.id)\n}\n\npage.domClick = event => {\n  // We are processing clicks this way to avoid using \"onclick\" attribute\n  // Apparently we will need to use \"unsafe-inline\" for \"script-src\" directive\n  // of Content Security Policy (CSP), if we want to use \"onclick\" attribute\n  // Though I think that only applies to some browsers (?)\n  // Of course it wouldn't have mattered if we didn't use CSP to begin with\n  // Anyway, I personally would rather not use \"onclick\" attribute\n  let element = event.target\n  if (!element) return\n\n  // Delegate click events to their A or BUTTON parents\n  if (['I'].includes(element.tagName) && ['SPAN'].includes(element.parentNode.tagName))\n    element = element.parentNode\n  if (['SPAN'].includes(element.tagName) && ['A', 'BUTTON'].includes(element.parentNode.tagName))\n    element = element.parentNode\n\n  // Skip elements that have no action data\n  if (!element.dataset || !element.dataset.action) return\n\n  // Skip disabled elements\n  if (element.hasAttribute('disabled')) return\n\n  event.stopPropagation() // maybe necessary\n  const id = page.getItemID(element)\n  const action = element.dataset.action\n\n  switch (action) {\n    case 'view-list':\n      return page.setUploadsView('list', element)\n    case 'view-thumbs':\n      return page.setUploadsView('thumbs', element)\n    case 'clear-selection':\n      return page.clearSelection()\n    case 'add-selected-uploads-to-album':\n      return page.addSelectedUploadsToAlbum()\n    case 'select':\n      return page.select(element, event)\n    case 'select-all':\n      return page.selectAll(element)\n    case 'add-to-album':\n      return page.addToAlbum(id)\n    case 'delete-upload':\n      return page.deleteUpload(id)\n    case 'bulk-delete-uploads':\n      return page.bulkDeleteUploads()\n    case 'display-preview':\n      return page.displayPreview(id)\n    case 'submit-album':\n      return page.submitAlbum(element)\n    case 'edit-album':\n      return page.editAlbum(id)\n    case 'delete-album':\n      return page.deleteAlbum(id)\n    case 'get-new-token':\n      return page.getNewToken(element)\n    case 'create-user':\n      return page.createUser()\n    case 'edit-user':\n      return page.editUser(id)\n    case 'disable-user':\n      return page.disableUser(id)\n    case 'delete-user':\n      return page.deleteUser(id)\n    case 'user-filters-help':\n      return page.userFiltersHelp(element)\n    case 'filter-uploads':\n      return page.filterUploads(element)\n    case 'view-user-uploads':\n      return page.viewUserUploads(id, element)\n    case 'page-ellipsis':\n      return page.focusJumpToPage()\n    case 'page-prev':\n    case 'page-next':\n    case 'page-goto':\n    case 'jump-to-page':\n      return page.switchPage(action, element)\n  }\n}\n\npage.fadeAndScroll = disableFading => {\n  if (page.fadingIn) {\n    clearTimeout(page.fadingIn)\n    page.dom.classList.remove('fade-in')\n  }\n\n  if (!disableFading) {\n    page.dom.classList.add('fade-in')\n    page.fadingIn = setTimeout(() => {\n      page.dom.classList.remove('fade-in')\n    }, 500)\n  }\n\n  page.dom.scrollIntoView({\n    behavior: disableFading ? 'auto' : 'smooth',\n    block: 'start',\n    inline: 'nearest'\n  })\n}\n\npage.switchPage = (action, element) => {\n  // eslint-disable-next-line compat/compat\n  const params = Object.assign({\n    trigger: element\n  }, page.views[page.currentView])\n\n  const func = page.currentView === 'users' ? page.getUsers : page.getUploads\n\n  switch (action) {\n    case 'page-prev':\n      params.pageNum = page.views[page.currentView].pageNum - 1\n      if (params.pageNum < 0)\n        return swal('An error occurred!', 'This is already the first page.', 'error')\n      return func(params)\n    case 'page-next':\n      params.pageNum = page.views[page.currentView].pageNum + 1\n      return func(params)\n    case 'page-goto':\n      params.pageNum = parseInt(element.dataset.goto)\n      return func(params)\n    case 'jump-to-page': {\n      const jumpToPage = document.querySelector('#jumpToPage')\n      if (!jumpToPage.checkValidity()) return\n      const parsed = parseInt(jumpToPage.value)\n      params.pageNum = isNaN(parsed) ? 0 : (parsed - 1)\n      if (params.pageNum < 0) params.pageNum = 0\n      return func(params)\n    }\n  }\n}\n\npage.focusJumpToPage = () => {\n  const element = document.querySelector('#jumpToPage')\n  if (!element) return\n  element.focus()\n  element.select()\n}\n\npage.getUploads = (params = {}) => {\n  if (params === undefined)\n    params = {}\n\n  if ((params.all || params.filters) && !page.permissions.moderator)\n    return swal('An error occurred!', 'You can not do this!', 'error')\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (typeof params.pageNum !== 'number' || params.pageNum < 0)\n    params.pageNum = 0\n\n  const url = params.album !== undefined\n    ? `api/album/${params.album}/${params.pageNum}`\n    : `api/uploads/${params.pageNum}`\n\n  const headers = {\n    all: params.all ? '1' : '',\n    filters: params.filters || ''\n  }\n\n  axios.get(url, { headers }).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const pages = Math.ceil(response.data.count / 25)\n    const files = response.data.files\n    if (params.pageNum && (files.length === 0))\n      if (params.autoPage) {\n        params.pageNum = pages - 1\n        return page.getUploads(params)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', `There are no more uploads to populate page ${params.pageNum + 1}.`, 'error')\n      }\n\n    page.currentView = params.all ? 'uploadsAll' : 'uploads'\n    page.cache.uploads = {}\n\n    const albums = response.data.albums\n    const users = response.data.users\n    const basedomain = response.data.basedomain\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    let filter = '<div class=\"column is-hidden-mobile\"></div>'\n    if (params.all)\n      filter = `\n        <div class=\"column\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filters\" value=\"${params.filters || ''}\">\n              </div>\n              <div class=\"control\">\n                <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help?\" data-action=\"user-filters-help\">\n                  <span class=\"icon\">\n                    <i class=\"icon-help-circled\"></i>\n                  </span>\n                </button>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter uploads\" data-action=\"filter-uploads\">\n                  <span class=\"icon\">\n                    <i class=\"icon-filter\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" min=\"1\" max=\"${pages}\" value=\"${params.pageNum + 1}\"${pages === 1 ? ' disabled' : ''}>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column is-hidden-mobile\"></div>\n        <div class=\"column has-text-centered\">\n          <a class=\"button is-small is-danger is-outlined\" title=\"List view\" data-action=\"view-list\">\n            <span class=\"icon\">\n              <i class=\"icon-th-list\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Thumbs view\" data-action=\"view-thumbs\">\n            <span class=\"icon\">\n              <i class=\"icon-th-large\"></i>\n            </span>\n          </a>\n        </div>\n        <div class=\"column has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          ${params.all ? '' : `\n          <a class=\"button is-small is-warning is-outlined\" title=\"Bulk add to album\" data-action=\"add-selected-uploads-to-album\">\n            <span class=\"icon\">\n              <i class=\"icon-plus\"></i>\n            </span>\n          </a>`}\n          <a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete\" data-action=\"bulk-delete-uploads\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    const hasExpiryDateColumn = files.some(file => {\n      return file.expirydate !== undefined\n    })\n\n    for (let i = 0; i < files.length; i++) {\n      // Build full URLs\n      files[i].file = `${basedomain}/${files[i].name}`\n      if (files[i].thumb)\n        files[i].thumb = `${basedomain}/${files[i].thumb}`\n\n      // Determine types\n      files[i].type = 'other'\n      const exec = /.[\\w]+(\\?|$)/.exec(files[i].file)\n      const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n      if (page.imageExts.includes(extname))\n        files[i].type = 'picture'\n      else if (page.videoExts.includes(extname))\n        files[i].type = 'video'\n\n      // Cache bare minimum data for thumbnails viewer\n      page.cache.uploads[files[i].id] = {\n        name: files[i].name,\n        thumb: files[i].thumb,\n        original: files[i].file,\n        type: files[i].type\n      }\n\n      // Prettify\n      files[i].prettyBytes = page.getPrettyBytes(parseInt(files[i].size))\n      files[i].prettyDate = page.getPrettyDate(new Date(files[i].timestamp * 1000))\n\n      if (hasExpiryDateColumn)\n        files[i].prettyExpiryDate = files[i].expirydate\n          ? page.getPrettyDate(new Date(files[i].expirydate * 1000))\n          : null\n\n      // Update selected status\n      files[i].selected = page.selected[page.currentView].includes(files[i].id)\n      if (!files[i].selected) unselected = true\n\n      // Appendix (display album or user)\n      if (params.all)\n        files[i].appendix = files[i].userid\n          ? users[files[i].userid] || ''\n          : ''\n      else if (params.album === undefined)\n        files[i].appendix = files[i].albumid\n          ? albums[files[i].albumid] || ''\n          : ''\n    }\n\n    if (page.views[page.currentView].type === 'thumbs') {\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div id=\"table\" class=\"columns is-multiline is-mobile is-centered\">\n        </div>\n        ${pagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const div = document.createElement('div')\n        div.className = 'image-container column'\n        div.dataset.id = upload.id\n\n        if (upload.thumb !== undefined)\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\"><img alt=\"${upload.name}\" data-src=\"${upload.thumb}\"/></a>`\n        else\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\"><h1 class=\"title\">${upload.extname || 'N/A'}</h1></a>`\n\n        div.innerHTML += `\n          <input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}>\n          <div class=\"controls\">\n            ${upload.thumb ? `\n            <a class=\"button is-small is-primary\" title=\"Display preview\" data-action=\"display-preview\">\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>` : ''}\n            <a class=\"button is-small is-info clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-warning\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-danger\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </div>\n          <div class=\"details\">\n            <p><span class=\"name\">${upload.name}</span></p>\n            <p>${upload.appendix ? `<span>${upload.appendix}</span> – ` : ''}${upload.prettyBytes}</p>\n            ${hasExpiryDateColumn && upload.prettyExpiryDate ? `\n            <p class=\"expirydate\">EXP: ${upload.prettyExpiryDate}</p>` : ''}\n          </div>\n        `\n\n        table.appendChild(div)\n        page.checkboxes[page.currentView] = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n      }\n    } else {\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div class=\"table-container\">\n          <table class=\"table is-narrow is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n                <th>File</th>\n                ${params.album === undefined ? `<th>${params.all ? 'User' : 'Album'}</th>` : ''}\n                <th>Size</th>\n                ${params.all ? '<th>IP</th>' : ''}\n                <th>Date</th>\n                ${hasExpiryDateColumn ? '<th>Expiry date</th>' : ''}\n                <th></th>\n              </tr>\n            </thead>\n            <tbody id=\"table\">\n            </tbody>\n          </table>\n        </div>\n        ${pagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const tr = document.createElement('tr')\n        tr.dataset.id = upload.id\n        tr.innerHTML = `\n          <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}></td>\n          <th><a href=\"${upload.file}\" target=\"_blank\" title=\"${upload.file}\">${upload.name}</a></th>\n          ${params.album === undefined ? `<th>${upload.appendix}</th>` : ''}\n          <td>${upload.prettyBytes}</td>\n          ${params.all ? `<td>${upload.ip || ''}</td>` : ''}\n          <td>${upload.prettyDate}</td>\n          ${hasExpiryDateColumn ? `<td>${upload.prettyExpiryDate || '-'}</td>` : ''}\n          <td class=\"controls has-text-right\">\n            <a class=\"button is-small is-primary is-outlined\" title=\"${upload.thumb ? 'Display preview' : 'File can\\'t be previewed'}\" data-action=\"display-preview\"${upload.thumb ? '' : ' disabled'}>\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            ${params.all ? '' : `\n            <a class=\"button is-small is-warning is-outlined\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>`}\n            <a class=\"button is-small is-danger is-outlined\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </td>\n        `\n\n        table.appendChild(tr)\n        page.checkboxes[page.currentView] = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n      }\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected && files.length) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    if (page.views[page.currentView].type === 'thumbs') {\n      page.fadeAndScroll(true)\n      page.lazyLoad.update()\n    } else {\n      page.fadeAndScroll()\n    }\n\n    page.updateTrigger(params.trigger, 'active')\n\n    if (page.currentView === 'uploads')\n      page.views.uploads.album = params.album\n    if (page.currentView === 'uploadsAll')\n      page.views.uploadsAll.filters = params.filters\n    page.views[page.currentView].pageNum = files.length ? params.pageNum : 0\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.setUploadsView = (view, element) => {\n  localStorage[lsKeys.viewType[page.currentView]] = view\n  page.views[page.currentView].type = view\n\n  // eslint-disable-next-line compat/compat\n  page.getUploads(Object.assign({\n    trigger: element\n  }, page.views[page.currentView]))\n}\n\npage.displayPreview = id => {\n  const file = page.cache.uploads[id]\n  if (!file.thumb) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field has-text-centered\">\n      <label class=\"label\">${file.name}</label>\n      <div class=\"controls swal-display-thumb-container\">\n        <img id=\"swalThumb\" src=\"${file.thumb}\">\n      </div>\n    </div>\n  `\n\n  if (file.original) {\n    const exec = /.[\\w]+(\\?|$)/.exec(file.original)\n    const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n    const isimage = page.imageExts.includes(extname)\n    const isvideo = !isimage && page.videoExts.includes(extname)\n\n    if (isimage || isvideo) {\n      div.innerHTML += `\n        <div class=\"field has-text-centered\">\n          <div class=\"controls\">\n            <a id=\"swalOriginal\" type=\"button\" class=\"button is-info is-outlined is-fullwidth\" data-original=\"${file.original}\">\n              <span class=\"icon\">\n                <i class=\"icon-arrows-cw\"></i>\n              </span>\n              <span>Load original</span>\n            </a>\n          </div>\n        </div>\n      `\n\n      div.querySelector('#swalOriginal').addEventListener('click', event => {\n        const trigger = event.currentTarget\n        if (trigger.classList.contains('is-danger'))\n          return\n\n        trigger.classList.add('is-loading')\n        const thumb = div.querySelector('#swalThumb')\n\n        if (isimage) {\n          thumb.src = file.original\n          thumb.onload = () => {\n            trigger.classList.add('is-hidden')\n            document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n          }\n          thumb.onerror = event => {\n            event.currentTarget.classList.add('is-hidden')\n            trigger.className = 'button is-danger is-fullwidth'\n            trigger.innerHTML = `\n              <span class=\"icon\">\n                <i class=\"icon-block\"></i>\n              </span>\n              <span>Unable to load original</span>\n            `\n          }\n        } else if (isvideo) {\n          thumb.classList.add('is-hidden')\n          const video = document.createElement('video')\n          video.id = 'swalVideo'\n          video.controls = true\n          video.autoplay = true\n          video.src = file.original\n          thumb.insertAdjacentElement('afterend', video)\n\n          trigger.classList.add('is-hidden')\n          document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n        }\n      })\n    }\n  }\n\n  return swal({\n    content: div,\n    buttons: false\n  }).then(() => {\n    // Destroy video, if necessary\n    const video = div.querySelector('#swalVideo')\n    if (video) video.remove()\n\n    // Restore modal size\n    document.body.querySelector('.swal-overlay .swal-modal').classList.remove('is-expanded')\n  })\n}\n\npage.selectAll = element => {\n  for (let i = 0; i < page.checkboxes[page.currentView].length; i++) {\n    const id = page.getItemID(page.checkboxes[page.currentView][i])\n    if (isNaN(id)) continue\n    if (page.checkboxes[page.currentView][i].checked !== element.checked) {\n      page.checkboxes[page.currentView][i].checked = element.checked\n      if (page.checkboxes[page.currentView][i].checked)\n        page.selected[page.currentView].push(id)\n      else\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n    }\n  }\n\n  if (page.selected[page.currentView].length)\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  else\n    delete localStorage[lsKeys.selected[page.currentView]]\n\n  element.title = element.checked ? 'Unselect all' : 'Select all'\n}\n\npage.selectInBetween = (element, lastElement) => {\n  const thisIndex = parseInt(element.dataset.index)\n  const lastIndex = parseInt(lastElement.dataset.index)\n\n  const distance = Math.abs(thisIndex - lastIndex)\n  if (distance < 2)\n    return\n\n  for (let i = 0; i < page.checkboxes[page.currentView].length; i++)\n    if ((thisIndex > lastIndex && i > lastIndex && i < thisIndex) ||\n      (thisIndex < lastIndex && i > thisIndex && i < lastIndex)) {\n      // Check or uncheck depending on the state of the initial checkbox\n      const checked = page.checkboxes[page.currentView][i].checked = lastElement.checked\n      const id = page.getItemID(page.checkboxes[page.currentView][i])\n      if (!page.selected[page.currentView].includes(id) && checked)\n        page.selected[page.currentView].push(id)\n      else if (page.selected[page.currentView].includes(id) && !checked)\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n    }\n}\n\npage.select = (element, event) => {\n  const id = page.getItemID(element)\n  if (isNaN(id)) return\n\n  const lastSelected = page.lastSelected[page.currentView]\n  if (event.shiftKey && lastSelected) {\n    page.selectInBetween(element, lastSelected)\n    // Check or uncheck depending on the state of the initial checkbox\n    element.checked = lastSelected.checked\n  } else {\n    page.lastSelected[page.currentView] = element\n  }\n\n  if (!page.selected[page.currentView].includes(id) && element.checked)\n    page.selected[page.currentView].push(id)\n  else if (page.selected[page.currentView].includes(id) && !element.checked)\n    page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n\n  // Update local storage\n  if (page.selected[page.currentView].length)\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  else\n    delete localStorage[lsKeys.selected[page.currentView]]\n}\n\npage.clearSelection = () => {\n  const selected = page.selected[page.currentView]\n  const type = page.currentView === 'users' ? 'users' : 'uploads'\n  const count = selected.length\n  if (!count)\n    return swal('An error occurred!', `You have not selected any ${type}.`, 'error')\n\n  const suffix = count === 1 ? type.substring(0, type.length - 1) : type\n  return swal({\n    title: 'Are you sure?',\n    text: `You are going to unselect ${count} ${suffix}.`,\n    buttons: true\n  }).then(proceed => {\n    if (!proceed) return\n\n    const checkboxes = page.checkboxes[page.currentView]\n    for (let i = 0; i < checkboxes.length; i++)\n      if (checkboxes[i].checked)\n        checkboxes[i].checked = false\n\n    page.selected[page.currentView] = []\n    delete localStorage[lsKeys.selected[page.currentView]]\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll) selectAll.checked = false\n\n    return swal('Cleared selection!', `Unselected ${count} ${suffix}.`, 'success')\n  })\n}\n\npage.userFiltersHelp = element => {\n  const content = document.createElement('div')\n  content.style = 'text-align: left'\n  content.innerHTML = `\n    This supports 3 filter keys, namely <b>user</b> (username), <b>ip</b> and <b>name</b> (upload name).\n    Each key can be specified more than once.\n    Backslashes should be used if the username contain whitespaces.\n\n    There are 2 special flags, namely <b>-user</b> and <b>-ip</b>, which will match uploads by non-registered users and have no IPs respectively.\n\n    Matches can also be sorted with <b>orderby:columnName[:direction]</b> key.\n    This key requires using the internal column names used in the database (size, timestamp, expirydate, and so on).\n    This key can also be specified more than once, where their order will decide the sorting steps.\n\n    <b>Internals:</b>\n    First, it will filter uploads matching ANY of the supplied filter keys AND/OR special flags, if any.\n    Second, it will refine the matches using the supplied <b>name</b> keys, if any.\n    Third, it will sort the matches using the supplied <b>orderby</b> keys, if any.\n\n    <b>Examples:</b>\n    Uploads from user with username \"demo\":\n    <code>user:demo</code>\n    Uploads from users with username \"John Doe\" AND/OR \"demo\":\n    <code>user:John\\\\ Doe user:demo</code>\n    Uploads from IP \"127.0.0.1\" AND which upload names match \"*.rar\" OR \"*.zip\":\n    <code>ip:127.0.0.1 name:*.rar name:*.zip</code>\n    Uploads from user with username \"test\" AND/OR from non-registered users:\n    <code>user:test -user</code>\n    Sort results by \"size\" column in ascending and descending order respectively:\n    <code>orderby:expirydate</code>\n    <code>user:demo orderby:size</code>\n    <code>-user name:*.mp4 orderby:size:desc</code>\n  `.trim().replace(/^ {6}/gm, '').replace(/\\n/g, '<br>')\n  swal({ content })\n}\n\npage.filterUploads = element => {\n  const filters = document.querySelector('#filters').value.trim()\n  page.getUploads({ all: true, filters }, element)\n}\n\npage.viewUserUploads = (id, element) => {\n  const user = page.cache.users[id]\n  if (!user) return\n  element.classList.add('is-loading')\n  page.getUploads({\n    all: true,\n    filters: `user:${user.username.replace(/ /g, '\\\\ ')}`,\n    trigger: document.querySelector('#itemManageUploads')\n  })\n}\n\npage.deleteUpload = id => {\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: [id],\n    cb (failed) {\n      // Remove from remembered checkboxes if necessary\n      if (!failed.length && page.selected[page.currentView].includes(id))\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n\n      // Update local storage\n      if (page.selected[page.currentView].length)\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      else\n        delete localStorage[lsKeys.selected[page.currentView]]\n\n      // Reload upload list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign({\n        autoPage: true\n      }, page.views[page.currentView]))\n    }\n  })\n}\n\npage.bulkDeleteUploads = () => {\n  const count = page.selected[page.currentView].length\n  if (!count)\n    return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: page.selected[page.currentView],\n    cb (failed) {\n      // Update state of checkboxes\n      if (failed.length)\n        page.selected[page.currentView] = page.selected[page.currentView]\n          .filter(id => {\n            return failed.includes(id)\n          })\n      else\n        page.selected[page.currentView] = []\n\n      // Update local storage\n      if (page.selected[page.currentView].length)\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      else\n        delete localStorage[lsKeys.selected[page.currentView]]\n\n      // Reload uploads list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign({\n        autoPage: true\n      }, page.views[page.currentView]))\n    }\n  })\n}\n\npage.deleteUploadsByNames = (params = {}) => {\n  let appendix = ''\n  if (page.permissions.moderator)\n    appendix = '<br><b>Hint:</b> You can use this feature to delete uploads by other users.'\n\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">Upload names:</label>\n        <div class=\"control\">\n          <textarea id=\"bulkDeleteNames\" class=\"textarea\"></textarea>\n        </div>\n        <p class=\"help\">Separate each entry with a new line.${appendix}</p>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"submitBulkDelete\" class=\"button is-danger is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#submitBulkDelete').addEventListener('click', () => {\n    const textArea = document.querySelector('#bulkDeleteNames')\n\n    // Clean up\n    const seen = {}\n    const names = textArea.value\n      .split(/\\r?\\n/)\n      .map(name => {\n        const trimmed = name.trim()\n        return /^[^\\s]+$/.test(trimmed)\n          ? trimmed\n          : ''\n      })\n      .filter(name => {\n        // Filter out invalid and duplicate names\n        return (!name || Object.prototype.hasOwnProperty.call(seen, name))\n          ? false\n          : (seen[name] = true)\n      })\n\n    // Update textarea with cleaned names\n    textArea.value = names.join('\\n')\n\n    if (!names.length)\n      return swal('An error occurred!', 'You have not entered any upload names.', 'error')\n\n    page.postBulkDeleteUploads({\n      all: true,\n      field: 'name',\n      values: names,\n      cb (failed) {\n        textArea.value = failed.join('\\n')\n      }\n    })\n  })\n}\n\npage.postBulkDeleteUploads = (params = {}) => {\n  const count = params.values.length\n\n  const objective = `${params.values.length} upload${count === 1 ? '' : 's'}`\n  const boldObjective = objective.replace(/^(\\d*)(.*)/, '<b>$1</b>$2')\n  let text = `<p>You won't be able to recover ${boldObjective}!</p>`\n\n  if (params.all) {\n    const obj1 = count === 1 ? 'an upload' : 'some uploads'\n    const obj2 = count === 1 ? 'another user' : 'other users'\n    text += `\\n<p><b>Warning:</b> You may be nuking ${obj1} by ${obj2}!</p>`\n  }\n\n  const content = document.createElement('div')\n  content.innerHTML = text\n\n  swal({\n    title: 'Are you sure?',\n    content,\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: `Yes, nuke ${params.values.length === 1 ? 'it' : 'them'}!`,\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/upload/bulkdelete', {\n      field: params.fields,\n      values: params.values\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      const failed = Array.isArray(response.data.failed) ? response.data.failed : []\n      if (failed.length === params.values.length)\n        swal('An error occurred!', `Unable to delete any of the ${objective}.`, 'error')\n      else if (failed.length && failed.length < params.values.length)\n        swal('Warning!', `From ${objective}, unable to delete ${failed.length} of them.`, 'warning')\n      else\n        swal('Deleted!', `${objective} ${count === 1 ? 'has' : 'have'} been deleted.`, 'success', {\n          buttons: false,\n          timer: 1500\n        })\n\n      if (typeof params.cb === 'function')\n        params.cb(failed)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.addSelectedUploadsToAlbum = () => {\n  if (page.currentView !== 'uploads')\n    return\n\n  const count = page.selected[page.currentView].length\n  if (!count)\n    return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.addUploadsToAlbum(page.selected[page.currentView], failed => {\n    if (!failed) return\n    if (failed.length)\n      page.selected[page.currentView] = page.selected[page.currentView].filter(id => {\n        return failed.includes(id)\n      })\n    else\n      page.selected[page.currentView] = []\n\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addToAlbum = id => {\n  page.addUploadsToAlbum([id], failed => {\n    if (!failed) return\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addUploadsToAlbum = (ids, callback) => {\n  const count = ids.length\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <div class=\"field has-text-centered\">\n      <p>You are about to add <b>${count}</b> upload${count === 1 ? '' : 's'} to an album.</p>\n      <p><b>If an upload is already in an album, it will be moved.</b></p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalAlbum\" disabled>\n            <option value=\"-1\">Remove from album</option>\n            <option value=\"\" selected disabled>Fetching albums list\\u2026</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  `\n\n  swal({\n    icon: 'warning',\n    content,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'OK',\n        closeModal: false\n      }\n    }\n  }).then(choose => {\n    if (!choose) return\n\n    const albumid = parseInt(document.querySelector('#swalAlbum').value)\n    if (isNaN(albumid))\n      return swal('An error occurred!', 'You did not choose an album.', 'error')\n\n    axios.post('api/albums/addfiles', {\n      ids,\n      albumid\n    }).then(add => {\n      if (!add) return\n\n      if (add.data.success === false) {\n        if (add.data.description === 'No token provided')\n          page.verifyToken(page.token)\n        else\n          swal('An error occurred!', add.data.description, 'error')\n\n        return\n      }\n\n      let added = ids.length\n      if (add.data.failed && add.data.failed.length)\n        added -= add.data.failed.length\n\n      const suffix = `upload${ids.length === 1 ? '' : 's'}`\n      if (!added)\n        return swal('An error occurred!', `Could not add the ${suffix} to the album.`, 'error')\n\n      swal('Woohoo!', `Successfully ${albumid < 0 ? 'removed' : 'added'} ${added} ${suffix} ${albumid < 0 ? 'from' : 'to'} the album.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      callback(add.data.failed)\n    }).catch(page.onAxiosError)\n  })\n\n  // Get albums list then update content of swal\n  axios.get('api/albums').then(list => {\n    if (list.data.success === false) {\n      if (list.data.description === 'No token provided')\n        page.verifyToken(page.token)\n      else\n        swal('An error occurred!', list.data.description, 'error')\n\n      return\n    }\n\n    // If the prompt was replaced, the container would be missing\n    const select = document.querySelector('#swalAlbum')\n    if (!select) return\n\n    select.innerHTML += list.data.albums\n      .map(album => {\n        return `<option value=\"${album.id}\">${album.name}</option>`\n      })\n      .join('\\n')\n\n    select.getElementsByTagName('option')[1].innerHTML = 'Choose an album'\n    select.removeAttribute('disabled')\n  }).catch(page.onAxiosError)\n}\n\npage.getAlbums = (params = {}) => {\n  page.updateTrigger(params.trigger, 'loading')\n\n  axios.get('api/albums').then(response => {\n    if (!response) return\n\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    page.cache.albums = {}\n\n    page.dom.innerHTML = `\n      <h2 class=\"subtitle\">Create new album</h2>\n      <form class=\"prevent-default\">\n        <div class=\"field\">\n          <div class=\"control\">\n            <input id=\"albumName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\">\n          </div>\n          <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <textarea id=\"albumDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"1\" maxlength=\"${page.albumDescMaxLength}\"></textarea>\n          </div>\n          <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <button type=\"submit\" id=\"submitAlbum\" class=\"button is-info is-outlined is-fullwidth\" data-action=\"submit-album\">\n              <span class=\"icon\">\n                <i class=\"icon-paper-plane\"></i>\n              </span>\n              <span>Create</span>\n            </button>\n          </div>\n        </div>\n      </form>\n      <hr>\n      <h2 class=\"subtitle\">List of albums</h2>\n      <div class=\"table-container\">\n        <table class=\"table is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th>ID</th>\n              <th>Name</th>\n              <th>Files</th>\n              <th>Created at</th>\n              <th>Public link</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n    `\n\n    const homeDomain = response.data.homeDomain\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < response.data.albums.length; i++) {\n      const album = response.data.albums[i]\n      const albumUrl = `${homeDomain}/a/${album.identifier}`\n\n      // Prettify\n      album.prettyDate = page.getPrettyDate(new Date(album.timestamp * 1000))\n\n      page.cache.albums[album.id] = {\n        name: album.name,\n        download: album.download,\n        public: album.public,\n        description: album.description\n      }\n\n      const tr = document.createElement('tr')\n      tr.innerHTML = `\n        <th>${album.id}</th>\n        <th>${album.name}</th>\n        <th>${album.files}</th>\n        <td>${album.prettyDate}</td>\n        <td><a ${album.public ? `href=\"${albumUrl}\"` : 'class=\"is-linethrough\"'} target=\"_blank\">${albumUrl}</a></td>\n        <td class=\"has-text-right\" data-id=\"${album.id}\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit album\" data-action=\"edit-album\">\n            <span class=\"icon is-small\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" ${album.public ? `data-clipboard-text=\"${albumUrl}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-clipboard\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"Download album\" ${album.download ? `href=\"api/album/zip/${album.identifier}?v=${album.editedAt}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-download\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Delete album\" data-action=\"delete-album\">\n            <span class=\"icon is-small\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n    }\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.editAlbum = id => {\n  const album = page.cache.albums[id]\n  if (!album) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <div class=\"controls\">\n        <input id=\"swalName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\" value=\"${(album.name || '').substring(0, page.albumTitleMaxLength)}\">\n      </div>\n      <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <textarea id=\"swalDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"2\" maxlength=\"${page.albumDescMaxLength}\">${(album.description || '').substring(0, page.albumDescMaxLength)}</textarea>\n      </div>\n      <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalDownload\" type=\"checkbox\" ${album.download ? 'checked' : ''}>\n          Enable download\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalPublic\" type=\"checkbox\" ${album.public ? 'checked' : ''}>\n          Enable public link\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalRequestLink\" type=\"checkbox\">\n          Request new public link\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Edit album',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(value => {\n    if (!value) return\n\n    axios.post('api/albums/edit', {\n      id,\n      name: document.querySelector('#swalName').value.trim(),\n      description: document.querySelector('#swalDescription').value.trim(),\n      download: document.querySelector('#swalDownload').checked,\n      public: document.querySelector('#swalPublic').checked,\n      requestLink: document.querySelector('#swalRequestLink').checked\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      if (response.data.identifier)\n        swal('Success!', `Your album's new identifier is: ${response.data.identifier}.`, 'success')\n      else if (response.data.name !== album.name)\n        swal('Success!', `Your album was renamed to: ${response.data.name}.`, 'success')\n      else\n        swal('Success!', 'Your album was edited!', 'success', {\n          buttons: false,\n          timer: 1500\n        })\n\n      page.getAlbumsSidebar()\n      page.getAlbums()\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.deleteAlbum = id => {\n  swal({\n    title: 'Are you sure?',\n    text: 'This won\\'t delete your uploads, only the album!',\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, delete it!',\n        closeModal: false\n      },\n      purge: {\n        text: 'Umm, delete the uploads too please?',\n        value: 'purge',\n        className: 'swal-button--danger',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/albums/delete', {\n      id,\n      purge: proceed === 'purge'\n    }).then(response => {\n      if (response.data.success === false) {\n        const failed = Array.isArray(response.data.failed)\n          ? response.data.failed\n          : []\n\n        if (response.data.description === 'No token provided')\n          return page.verifyToken(page.token)\n        else if (failed.length)\n          return swal('An error occurred!', `Unable to delete ${failed.length} of the album's upload${failed.length === 1 ? '' : 's'}.`, 'error')\n        else\n          return swal('An error occurred!', response.data.description, 'error')\n      }\n\n      swal('Deleted!', 'Your album has been deleted.', 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      page.getAlbumsSidebar()\n      page.getAlbums()\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.submitAlbum = element => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/albums', {\n    name: document.querySelector('#albumName').value.trim(),\n    description: document.querySelector('#albumDescription').value.trim()\n  }).then(response => {\n    if (!response) return\n\n    page.updateTrigger(element)\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    swal('Woohoo!', 'Album was created successfully.', 'success', {\n      buttons: false,\n      timer: 1500\n    })\n    page.getAlbumsSidebar()\n    page.getAlbums()\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getAlbumsSidebar = () => {\n  axios.get('api/albums/sidebar').then(response => {\n    if (!response) return\n\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const albumsContainer = document.querySelector('#albumsContainer')\n\n    // Clear albums sidebar if necessary\n    const oldAlbums = albumsContainer.querySelectorAll('li > a')\n    if (oldAlbums.length) {\n      for (let i = 0; i < oldAlbums.length; i++)\n        page.menus.splice(page.menus.indexOf(oldAlbums[i]), 1)\n      albumsContainer.innerHTML = ''\n    }\n\n    if (response.data.albums === undefined)\n      return\n\n    for (let i = 0; i < response.data.albums.length; i++) {\n      const album = response.data.albums[i]\n      const li = document.createElement('li')\n      const a = document.createElement('a')\n      a.id = album.id\n      a.innerHTML = album.name\n      a.className = 'is-relative'\n\n      a.addEventListener('click', event => {\n        page.getUploads({\n          album: parseInt(event.currentTarget.id),\n          trigger: event.currentTarget\n        })\n      })\n      page.menus.push(a)\n\n      li.appendChild(a)\n      albumsContainer.appendChild(li)\n    }\n  }).catch(page.onAxiosError)\n}\n\npage.changeToken = (params = {}) => {\n  page.dom.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Your current token:</label>\n      <div class=\"field\">\n        <div class=\"control\">\n          <input id=\"token\" readonly class=\"input\" type=\"text\" placeholder=\"Your token\" value=\"${page.token}\">\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <a id=\"getNewToken\" class=\"button is-info is-outlined is-fullwidth\">\n          <span class=\"icon\">\n            <i class=\"icon-arrows-cw\"></i>\n          </span>\n          <span>Request new token</span>\n        </a>\n      </div>\n    </div>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#getNewToken').addEventListener('click', event => {\n    const trigger = event.currentTarget\n    page.updateTrigger(trigger, 'loading')\n    axios.post('api/tokens/change').then(response => {\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          page.updateTrigger(trigger)\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      page.updateTrigger(trigger)\n      swal({\n        title: 'Woohoo!',\n        text: 'Your token was successfully changed.',\n        icon: 'success'\n      }).then(() => {\n        axios.defaults.headers.common.token = response.data.token\n        localStorage[lsKeys.token] = response.data.token\n        page.token = response.data.token\n        page.changeToken()\n      })\n    }).catch(error => {\n      page.updateTrigger(trigger)\n      page.onAxiosError(error)\n    })\n  })\n}\n\npage.changePassword = (params = {}) => {\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">New password:</label>\n        <div class=\"control\">\n          <input id=\"password\" class=\"input\" type=\"password\" minlength=\"6\" maxlength=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <label class=\"label\">Re-type new password:</label>\n        <div class=\"control\">\n          <input id=\"passwordConfirm\" class=\"input\" type=\"password\" minlength=\"6\" maxlength=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"sendChangePassword\" class=\"button is-info is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-paper-plane\"></i>\n            </span>\n            <span>Set new password</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeAndScroll()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#sendChangePassword').addEventListener('click', event => {\n    if (!page.dom.querySelector('form').checkValidity()) return\n    if (document.querySelector('#password').value === document.querySelector('#passwordConfirm').value)\n      page.sendNewPassword(document.querySelector('#password').value, event.currentTarget)\n    else\n      swal({\n        title: 'Password mismatch!',\n        text: 'Your passwords do not match, please try again.',\n        icon: 'error'\n      })\n  })\n}\n\npage.sendNewPassword = (pass, element) => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/password/change', { password: pass }).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(element)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    page.updateTrigger(element)\n    swal({\n      title: 'Woohoo!',\n      text: 'Your password was successfully changed.',\n      icon: 'success',\n      buttons: false,\n      timer: 1500\n    }).then(() => {\n      page.changePassword()\n    })\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getUsers = (params = {}) => {\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (params.pageNum === undefined)\n    params.pageNum = 0\n\n  if (!page.permissions.admin)\n    return swal('An error occurred!', 'You can not do this!', 'error')\n\n  const url = `api/users/${params.pageNum}`\n  axios.get(url).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    const pages = Math.ceil(response.data.count / 25)\n    if (params.pageNum && (response.data.users.length === 0))\n      if (params.autoPage) {\n        params.pageNum = pages - 1\n        return page.getUsers(params)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', `There are no more users to populate page ${params.pageNum + 1}.`, 'error')\n      }\n\n    page.currentView = 'users'\n    page.cache.users = {}\n\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    const filter = `\n      <div class=\"column\">\n        <form class=\"prevent-default\">\n          <div class=\"field has-addons\">\n            <div class=\"control is-expanded\">\n              <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filters (WIP)\" value=\"${params.filters || ''}\" disabled>\n            </div>\n            <div class=\"control\">\n              <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help? (WIP)\" data-action=\"upload-filters-help\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-help-circled\"></i>\n                </span>\n              </button>\n            </div>\n            <div class=\"control\">\n              <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter users (WIP)\" data-action=\"filter-users\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-filter\"></i>\n                </span>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" min=\"1\" max=\"${pages}\" value=\"${params.pageNum + 1}\"${pages === 1 ? ' disabled' : ''}>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column has-text-left\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Create user (WIP)\" data-action=\"create-user\">\n            <span class=\"icon\">\n              <i class=\"icon-plus\"></i>\n            </span>\n            <span>Create user</span>\n        </a>\n        </div>\n        <div class=\"column has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"Bulk disable (WIP)\" data-action=\"bulk-disable-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete (WIP)\" data-action=\"bulk-delete-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    page.dom.innerHTML = `\n      ${pagination}\n      ${extraControls}\n      ${controls}\n      <div class=\"table-container\">\n        <table class=\"table is-narrow is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n              <th>ID</th>\n              <th>Username</th>\n              <th>Uploads</th>\n              <th>Usage</th>\n              <th>Group</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n      ${pagination}\n    `\n\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < response.data.users.length; i++) {\n      const user = response.data.users[i]\n      const selected = page.selected.users.includes(user.id)\n      if (!selected) unselected = true\n\n      let displayGroup = null\n      const groups = Object.keys(user.groups)\n      for (let i = 0; i < groups.length; i++) {\n        if (!user.groups[groups[i]]) break\n        displayGroup = groups[i]\n      }\n\n      // Server-side explicitly expects either of these two values to consider a user as disabled\n      const enabled = user.enabled !== false && user.enabled !== 0\n      page.cache.users[user.id] = {\n        username: user.username,\n        groups: user.groups,\n        enabled,\n        displayGroup\n      }\n\n      const tr = document.createElement('tr')\n      tr.dataset.id = user.id\n      tr.innerHTML = `\n        <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${selected ? ' checked' : ''}></td>\n        <th>${user.id}</th>\n        <th${enabled ? '' : ' class=\"is-linethrough\"'}>${user.username}</td>\n        <th>${user.uploads}</th>\n        <td>${page.getPrettyBytes(user.usage)}</td>\n        <td>${displayGroup}</td>\n        <td class=\"controls has-text-right\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit user\" data-action=\"edit-user\">\n            <span class=\"icon\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined\" title=\"${user.uploads ? 'View uploads' : 'User doesn\\'t have uploads'}\" data-action=\"view-user-uploads\" ${user.uploads ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-docs\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"${enabled ? 'Disable user' : 'User is disabled'}\" data-action=\"disable-user\" ${enabled ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Delete user\" data-action=\"delete-user\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n      page.checkboxes.users = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n\n    page.views.users.pageNum = response.data.users.length ? params.pageNum : 0\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.createUser = () => {\n  const groupOptions = Object.keys(page.permissions).map((g, i, a) => {\n    const disabled = !(a[i + 1] && page.permissions[a[i + 1]])\n    return `<option value=\"${g}\"${disabled ? ' disabled' : ''}>${g}</option>`\n  }).join('\\n')\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Username</label>\n      <div class=\"controls\">\n        <input id=\"swalUsername\" class=\"input\" type=\"text\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">Password (optional)</label>\n      <div class=\"controls\">\n        <input id=\"swalPassword\" class=\"input\" type=\"text\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">User group</label>\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalGroup\">\n            ${groupOptions}\n          </select>\n        </div>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Create new user',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/create', {\n      username: document.querySelector('#swalUsername').value,\n      password: document.querySelector('#swalPassword').value,\n      group: document.querySelector('#swalGroup').value\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      const div = document.createElement('div')\n      div.innerHTML = `\n        <p>Username: <b>${response.data.username}</b></p>\n        <p>Password: <code>${response.data.password}</code></p>\n        <p>User group: <b>${response.data.group}</b></p>\n      `\n      swal({\n        title: 'Created a new user!',\n        icon: 'success',\n        content: div\n      })\n\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.editUser = id => {\n  const user = page.cache.users[id]\n  if (!user) return\n\n  const groupOptions = Object.keys(page.permissions).map((g, i, a) => {\n    const selected = g === user.displayGroup\n    const disabled = !(a[i + 1] && page.permissions[a[i + 1]])\n    return `<option value=\"${g}\"${selected ? ' selected' : ''}${disabled ? ' disabled' : ''}>${g}</option>`\n  }).join('\\n')\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Username</label>\n      <div class=\"controls\">\n        <input id=\"swalUsername\" class=\"input\" type=\"text\" value=\"${user.username || ''}\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">User group</label>\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalGroup\">\n            ${groupOptions}\n          </select>\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalEnabled\" type=\"checkbox\" ${user.enabled ? 'checked' : ''}>\n          Enabled\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalResetPassword\" type=\"checkbox\">\n          Reset password\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Edit user',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/edit', {\n      id,\n      username: document.querySelector('#swalUsername').value,\n      group: document.querySelector('#swalGroup').value,\n      enabled: document.querySelector('#swalEnabled').checked,\n      resetPassword: document.querySelector('#swalResetPassword').checked\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n\n      if (response.data.password) {\n        const div = document.createElement('div')\n        div.innerHTML = `\n          <p><b>${user.username}</b>'s new password is:</p>\n          <p><code>${response.data.password}</code></p>\n        `\n        swal({\n          title: 'Success!',\n          icon: 'success',\n          content: div\n        })\n      } else if (response.data.update && response.data.update.username !== user.username) {\n        swal('Success!', `${user.username} was renamed into: ${response.data.update.username}.`, 'success')\n      } else {\n        swal('Success!', 'The user was edited!', 'success', {\n          buttons: false,\n          timer: 1500\n        })\n      }\n\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.disableUser = id => {\n  const user = page.cache.users[id]\n  if (!user || !user.enabled) return\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p>You will be disabling a user named <b>${page.cache.users[id].username}</b>.</p>\n    <p>Their files will remain.</p>\n  `\n\n  swal({\n    title: 'Are you sure?',\n    icon: 'warning',\n    content,\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, disable them!',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/disable', { id }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false)\n        if (response.data.description === 'No token provided')\n          return page.verifyToken(page.token)\n        else\n          return swal('An error occurred!', response.data.description, 'error')\n\n      swal('Success!', `${page.cache.users[id].username} has been disabled.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.deleteUser = id => {\n  const user = page.cache.users[id]\n  if (!user) return\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p>You will be deleting a user named <b>${page.cache.users[id].username}</b>.<p>\n    <p>Their files will remain, unless you choose otherwise.</p>\n  `\n\n  swal({\n    title: 'Are you sure?',\n    icon: 'warning',\n    content,\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, delete it!',\n        closeModal: false\n      },\n      purge: {\n        text: 'Yes, and the uploads too!',\n        value: 'purge',\n        className: 'swal-button--danger',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/delete', {\n      id,\n      purge: proceed === 'purge'\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        const failed = Array.isArray(response.data.failed)\n          ? response.data.failed\n          : []\n\n        if (response.data.description === 'No token provided')\n          return page.verifyToken(page.token)\n        else if (failed.length)\n          return swal('An error occurred!', `Unable to delete ${failed.length} of the user's upload${failed.length === 1 ? '' : 's'}.`, 'error')\n        else\n          return swal('An error occurred!', response.data.description, 'error')\n      }\n\n      swal('Success!', `${page.cache.users[id].username} has been deleted.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n\n      // Reload users list\n      // eslint-disable-next-line compat/compat\n      page.getUsers(Object.assign({\n        autoPage: true\n      }, page.views.users))\n    }).catch(page.onAxiosError)\n  })\n}\n\n// Roughly based on https://github.com/mayuska/pagination/blob/master/index.js\npage.paginate = (totalItems, itemsPerPage, currentPage) => {\n  currentPage = currentPage + 1\n  const step = 3\n  const numPages = Math.ceil(totalItems / itemsPerPage)\n\n  let template = ''\n  const elementsToShow = step * 2\n  const add = {\n    pageNum (start, end) {\n      for (let i = start; i <= end; ++i)\n        template += `<li><a class=\"button pagination-link ${i === currentPage ? ' is-current' : ''}\" aria-label=\"Goto page ${i}\" data-action=\"page-goto\" data-goto=\"${i - 1}\">${i}</a></li>`\n    },\n    startDots () {\n      template += `\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page 1\" data-action=\"page-goto\" data-goto=\"0\">1</a></li>\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n      `\n    },\n    endDots () {\n      template += `\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page ${numPages}\" data-action=\"page-goto\" data-goto=\"${numPages - 1}\">${numPages}</a></li>\n      `\n    }\n  }\n\n  if (elementsToShow + 1 >= numPages) {\n    add.pageNum(1, numPages)\n  } else if (currentPage < elementsToShow) {\n    add.pageNum(1, elementsToShow)\n    add.endDots()\n  } else if (currentPage > numPages - elementsToShow + 1) {\n    add.startDots()\n    add.pageNum(numPages - elementsToShow + 1, numPages)\n  } else {\n    add.startDots()\n    add.pageNum(currentPage - step + 1, currentPage + step - 1)\n    add.endDots()\n  }\n\n  return `\n    <nav class=\"pagination is-centered is-small\">\n      <a class=\"button pagination-previous\" data-action=\"page-prev\"${currentPage === 1 ? ' disabled' : ''}>Previous</a>\n      <a class=\"button pagination-next\" data-action=\"page-next\"${currentPage === numPages ? ' disabled' : ''}>Next page</a>\n      <ul class=\"pagination-list\">${template}</ul>\n    </nav>\n  `\n}\n\npage.getStatistics = (params = {}) => {\n  if (!page.permissions.admin)\n    return swal('An error occurred!', 'You can not do this!', 'error')\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  const url = 'api/stats'\n  axios.get(url).then(response => {\n    if (response.data.success === false)\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n\n    let content = ''\n    const keys = Object.keys(response.data.stats)\n    for (let i = 0; i < keys.length; i++) {\n      let rows = ''\n      if (!response.data.stats[keys[i]])\n        rows += `\n          <tr>\n            <td>Generating, please try again later\\u2026</td>\n            <td></td>\n          </tr>\n        `\n      else\n        try {\n          const types = response.data.stats[keys[i]]._types || {}\n          const valKeys = Object.keys(response.data.stats[keys[i]])\n          for (let j = 0; j < valKeys.length; j++) {\n            // Skip keys that starts with an underscore\n            if (/^_/.test(valKeys[j]))\n              continue\n\n            const value = response.data.stats[keys[i]][valKeys[j]]\n            let parsed = value\n\n            // Parse values with some preset formatting\n            if ((types.number || []).includes(valKeys[j]))\n              parsed = value.toLocaleString()\n            if ((types.byte || []).includes(valKeys[j]))\n              parsed = page.getPrettyBytes(value)\n            if ((types.byteUsage || []).includes(valKeys[j]))\n              parsed = `${page.getPrettyBytes(value.used)} / ${page.getPrettyBytes(value.total)} (${Math.round(value.used / value.total * 100)}%)`\n\n            const string = valKeys[j]\n              .replace(/([A-Z])/g, ' $1')\n              .toUpperCase()\n            rows += `\n              <tr>\n                <th>${string}</th>\n                <td>${parsed}</td>\n              </tr>\n            `\n          }\n        } catch (error) {\n          rows = `\n              <tr>\n                <td>Error parsing response. Try again?</td>\n                <td></td>\n              </tr>\n            `\n          page.onError(error)\n        }\n\n      content += `\n        <div class=\"table-container\">\n          <table id=\"statistics\" class=\"table is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th>${keys[i].toUpperCase()}</th>\n                <td></td>\n              </tr>\n            </thead>\n            <tbody>\n              ${rows}\n            </tbody>\n          </table>\n        </div>\n      `\n    }\n\n    page.dom.innerHTML = content\n    page.fadeAndScroll()\n    page.updateTrigger(params.trigger, 'active')\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\nwindow.onload = () => {\n  // Polyfill Object.assign()\n  // eslint-disable-next-line compat/compat\n  if (typeof Object.assign !== 'function')\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, 'assign', {\n      value: function assign (target, varArgs) { // .length of function is 2\n        'use strict'\n        if (target === null || target === undefined)\n          throw new TypeError('Cannot convert undefined or null to object')\n        const to = Object(target)\n        for (let i = 1; i < arguments.length; i++) {\n          const nextSource = arguments[i]\n          if (nextSource !== null && nextSource !== undefined)\n            for (const nextKey in nextSource)\n              // Avoid bugs when hasOwnProperty is shadowed\n              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey))\n                to[nextKey] = nextSource[nextKey]\n        }\n        return to\n      },\n      writable: true,\n      configurable: true\n    })\n\n  // Add 'no-touch' class to non-touch devices\n  if (!('ontouchstart' in document.documentElement))\n    document.documentElement.classList.add('no-touch')\n\n  const selectedKeys = ['uploads', 'uploadsAll', 'users']\n  for (let i = 0; i < selectedKeys.length; i++) {\n    const ls = localStorage[lsKeys.selected[selectedKeys[i]]]\n    if (ls) page.selected[selectedKeys[i]] = JSON.parse(ls)\n  }\n\n  page.preparePage()\n\n  page.clipboardJS = new ClipboardJS('.clipboard-js')\n\n  page.clipboardJS.on('success', () => {\n    return swal('', 'The link has been copied to clipboard.', 'success', {\n      buttons: false,\n      timer: 1500\n    })\n  })\n\n  page.clipboardJS.on('error', page.onError)\n\n  page.lazyLoad = new LazyLoad()\n}\n"]}